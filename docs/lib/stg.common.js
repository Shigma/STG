module.exports=function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=21)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1);e.default={...i._config,angleUnit:Math.PI,defaultColor:"blue",publicPath:"/",showWarning:!0,scheduleLimit:256,maxBulletCount:4096,grazeTimeout:20,grazeBonus:5,grazeFilter:"sepia(0.7) saturate(4)",imageUpdate:{static:6,leftward:3,rightward:3,fogEffect:3,spell:4,bullet:3}}},function(t,e,s){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)Object.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e.default=t,e},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(22));e.random=n;const o=r(s(14));e.memorize=o.default;const a=r(s(5));e._config=a.default;const h=r(s(23));e.color=h.default;const l=r(s(24));e.math=l.default,function(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}(s(5))},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(0)),n=i(s(6)),o=s(1),a=s(9),h=i(s(7)),l=i(s(8));e.default=class extends l.default{constructor(t={}){super(),this._point={x:0,y:0,face:0},this._mountedHook=t.mounted?[t.mounted]:[],this._mutateHook=t.mutate?[t.mutate]:[],Object.assign(this,t.methods);const e="function"==typeof t.state?t.state.call(this):t.state;Object.assign(this,e),this.color||(this.color=r.default.defaultColor),this.$display=t.display,this.$mappingTick=0,this.$direction="static"}get x(){return this._point.x}get y(){return this._point.y}get face(){return this._point.face}set x(t){this._point.x=t,this._coordinate=null}set y(t){this._point.y=t,this._coordinate=null}set face(t){this._point.face=t,this._coordinate=null}get $player(){return this.$barrage.$refs.player}get $display(){return this._displayHook}set $display(t){if("string"==typeof t){const e=n.default.display.resolve(t,this);e.applied&&e.applied.call(this),this._displayHook=e.display}else this._displayHook=t;this.$displayTick=0}drawTemplate(t,e=0){n.default.display.resolve(t,this).display.call(this,e)}_mounted(){this._mutateHook.forEach(t=>this.setTask(t,0)),this._mountedHook.forEach(t=>t.call(this))}update(){this.$tick&&(this.$displayTick+=1);const t=this.$coord.x,e=this.$mapping;super.update();const s=o.math.sign(this.$coord.x-t);this.$direction=s?s>0?"rightward":"leftward":"static",this.$mapping!==e?this.$mappingTick=0:this.$tick&&(this.$mappingTick+=1)}get $mapping(){return this.$action||this.$direction}render(){this.$context&&"function"==typeof this._displayHook&&this._displayHook.call(this,this.$displayTick)}get $coord(){return this._coordinate&&this.$tick===this._coordinate.$birth||(this._coordinate=h.default.from(this),this._coordinate.$birth=this.$tick),this._coordinate}emitBullets(...t){this.$barrage.$refs.source=this,this.$barrage.emitBullets(...t),delete this.$barrage.$refs.source}drawImage(t,e={},s){const{x:i,y:n,face:h}=this.$coord;"string"==typeof t&&([t]=a.images.get(t));const{xStart:l,xEnd:u,yStart:c,yEnd:f}=s||{xStart:0,yStart:0,xEnd:t.width,yEnd:t.height},d=u-l,p=f-c,{scale:g=1,xOffset:m=0,yOffset:y=0,rotate:_=(void 0===this.spin?h:this.spin)}=e,b=d*g,x=p*g,v=-(d/2+m)*g,w=-(p/2+y)*g,k=o.math.sin(r.default.angleUnit*_),$=o.math.cos(r.default.angleUnit*_);this.$context.setTransform(-k,$,-$,-k,i,n),this.$context.drawImage(t,l,c,d,p,v,w,b,x),this.$context.setTransform(1,0,0,1,0,0)}fillCircle(t=this.color,e=this.radius){const{x:s,y:i}=this.$coord;this.$context.beginPath(),this.$context.arc(s,i,e,0,o.math.twoPI),this.$context.closePath(),this.$context.fillStyle=t.output?t.output():t,this.$context.fill()}fillEllipse(t=this.color,e=this.innerColor,s=this.radiusX,i=this.radiusY,n=this.face){const{x:a,y:h}=this.$coord;this.$context.beginPath(),this.$context.strokeStyle=t,this.$context.lineWidth=2,this.$context.ellipse(a,h,s,i,n*r.default.angleUnit,0,o.math.twoPI),this.$context.closePath(),this.$context.stroke(),this.$context.fillStyle=e.output?e.output():e,this.$context.fill()}getGradient(t,e,s=this.color,i=this.radius){const{x:r,y:n}=this.$coord,o=this.$context.createRadialGradient(r,n,e,r,n,i);return o.addColorStop(0,t.output?t.output():t),o.addColorStop(1,s.output?s.output():s),o}bezierCurve(...t){if(t.length%6==2){const e=this.$coord.resolve(t[0],t[1]);this.$context.moveTo(e.x,e.y)}for(let e=0;e<t.length;e+=6){const s=this.$coord.resolve(t[e],t[e+1]),i=this.$coord.resolve(t[e+2],t[e+3]),r=this.$coord.resolve(t[e+4],t[e+5]);this.$context.bezierCurveTo(s.x,s.y,i.x,i.y,r.x,r.y)}}quadraticCurve(...t){if(t.length%4==2){const e=this.$coord.resolve(t[0],t[1]);this.$context.moveTo(e.x,e.y)}for(let e=0;e<t.length;e+=4){const s=this.$coord.resolve(t[e],t[e+1]),i=this.$coord.resolve(t[e+2],t[e+3]);this.$context.quadraticCurveTo(s.x,s.y,i.x,i.y)}}toJSON(){const t={};for(const e in this)("string"==typeof e&&"$"!==e[0]&&"_"!==e[0]||"$tick"===e)&&(t[e]=this[e]);return t}}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(1),n=i(s(19)),o={4:r.color.scheme4,8:r.color.scheme8,16:r.color.scheme16};function a(t,e,s){const i={};return Object.keys(s).forEach(r=>{const[n,o,...a]=s[r];i[r]={data:[]},a.forEach((s,a)=>{const h=o+a*e;for(let o=0;o<s;o+=1){const s=n+o*t;i[r].data.push([s,h,s+t,h+e])}})}),i}function h(t,e=256/t,s=1){const i=e/s;return(s,r,n,a,h,l,u)=>{const c={};return o[e].forEach((e,o)=>{const f=n+o*t,d=a+Math.floor(o/i)*t;c[`${s}?color=${e}`]={judgeRadius:r,transform:u,spinning:l,fogEffect:h,position:[f,d,f+t,d+t]}}),c}}e.generateTouhouPlugin=function(t){const e={};for(const s in t)e[s]=(async(e,i)=>{const r=await e.loadImages(i);e.buildEmitter(r,{[s]:t[s]})});return e.install=(async(s,i)=>{await Promise.all(Object.keys(t).map(async t=>{i[t]&&s.use(e[t],i[t])}).concat([s.use(n.default,i)]))}),e},e.checkAssets=function(t,e){if(!e)throw new Error("Image assets are required for the plugin.");t.forEach(t=>{if(!(t in e))throw new Error(`Asset ${t} is required for the plugin.`)})},e.prefix=function(t,e){const s={};for(const i in e)s[t+i]=e[i];return s},e.playerAsset=a(32,48,{static:[0,0,8],leftward:[0,48,8],rightward:[0,96,8]}),e.defineEmitterAsset=a,e.bullet8x32p=h(32),e.bullet4x64p=h(64),e.bullet16x16p=h(16),e.bullet16x8p=h(8,16,2)},function(t,e,s){"use strict";function i(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=r(s(9));e.assets=n.default;const o=r(s(0));e.config=o.default;const a=r(s(6));e.template=a.default;const h=r(s(10));e.Barrage=h.default;const l=r(s(11));e.Bullet=l.default;const u=r(s(7));e.Coordinate=u.default;const c=r(s(16));e.Field=c.default;const f=r(s(12));e.Looping=f.default;const d=r(s(13));e.Player=d.default;const p=r(s(2));e.CanvasPoint=p.default;const g=r(s(8));e.Updater=g.default,i(s(9)),i(s(10)),i(s(11)),i(s(7)),i(s(16)),i(s(12)),i(s(13)),i(s(17)),i(s(2)),i(s(6)),i(s(8))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={cacheSize:4096,minValue:1e-4}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(0)),n=s(15),o=i(s(32)),a=i(s(33));class h{constructor(t={}){this._data={},this.define(t)}define(...t){"string"==typeof t[0]?this._data[t[0]]=t[1]:Object.assign(this._data,t[0])}resolve(t){if("string"!=typeof t)return t;const e=this._data[t];if(!e)throw new Error(`Template ${t} was not found.`);return e}}class l{constructor(){this._data={}}define(...t){if("string"!=typeof t[0]){for(const e in t[0])this.define(e,t[0][e]);return}const e=/^([\w_$]+)(?:\?(.+))?$/.exec(t[0]);if(!e)throw new Error(`Invalid form: "${t[0]}".`);const s=e[1],i=t[0],r=n.parse(e[2]),o=Object.keys(r).length;this._data[s]=this._data[s]||[];let a=0,h=null;for(;a<this._data[s].length;a+=1){const t=this._data[s][a];if(t.query===i)break;if(t.weight<=o&&(null===h&&(h=a),t.weight<o))break}this._data[s][a]&&this._data[s][a].query===i?Object.assign(this._data[s][a],t[1]):this._data[s].splice(null===h?1/0:h,0,{query:i,weight:o,...t[1],test(t){for(const e in r)if(t[e]!=r[e])return!1;return!0}})}resolve(t,e){if("string"!=typeof t)return t;const s=(this._data[t]||[]).find(t=>t.test(e));if(!s)throw new Error(`A template matching ${t} was not found.`);return s}buildEmitter(t,e){for(const s in e){const i=e[s];for(const t in i)i[t].interval=i[t].interval||r.default.imageUpdate[t]||1;this.define(s,{display(){const{data:e,interval:s,transform:r={}}=i[this.$mapping];let n=Math.floor(this.$mappingTick/s);"leftward"===this.$mapping||"rightward"===this.$mapping?n>=e.length&&(n=e.length-1):n%=e.length;const[o,a,h,l]=e[n];this.drawImage(t,r,{xStart:o,yStart:a,xEnd:h,yEnd:l})}})}}buildBullet(t,e){for(const s in e){let{position:i,judgeRadius:n,spinning:o,fogEffect:a,transform:h={}}=e[s];Array.isArray(i)&&(i={data:[i]});const{interval:l=r.default.imageUpdate.bullet,data:u}=i;h.rotate=o?void 0:0,this.define(s,{applied(){"number"==typeof n&&(this.judgeRadius=n)},display(e){if(a&&e<=r.default.imageUpdate.fogEffect)this.drawTemplate(a);else{const s=Math.floor(e/l)%u.length,[i,r,n,o]=u[s];this.drawImage(t,h,{xStart:i,yStart:r,xEnd:n,yEnd:o})}}})}}}e.DisplayManager=l;const u=new h(o.default),c=new h(a.default),f=new l;e.default={fields:u,judges:c,display:f},e.buildBullet=function(t,e){f.buildBullet(t,e)},e.buildEmitter=function(t,e){f.buildEmitter(t,e)},e.defineTemplate=function(...t){f.define(...t)}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(1),n=i(s(0));class o{static from(t){return new o(t.x,t.y,t.face)}constructor(t,e,s){this.x=t,this.y=e,this.face=s}get face(){return this._face}set face(t){this._face=t||0,this._cos=r.math.cos(n.default.angleUnit*t||0),this._sin=r.math.sin(n.default.angleUnit*t||0)}get rho(){return this._rho?this._rho:this._rho=r.math.sqrt(this.x**2+this.y**2)}get theta(){return this.thetaRadian/n.default.angleUnit}get thetaRadian(){return"number"==typeof this._thetaRadian?this._thetaRadian:this._thetaRadian=r.math.atan2(this.y,this.x)}dist2(t){return(this.x-t.x)**2+(this.y-t.y)**2}resolve(...t){let e,s,i;return"object"==typeof t[0]?(e=t[0].x,s=t[0].y,i=t[0].face):[e,s,i=0]=t,new o(this.x+e*this._cos-s*this._sin,this.y+e*this._sin+s*this._cos,this.face+i)}locate(...t){let e,s,i;"object"==typeof t[0]?(e=t[0].x,s=t[0].y,i=t[0].face):[e,s,i=0]=t;const r=e-this.x,n=s-this.y;return new o(r*this._cos+n*this._sin,n*this._cos-r*this._sin,i-this.face)}}e.default=o},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(0));e.default=class{constructor(){this.$tick=0,Object.defineProperty(this,"__updater__",{value:{tasks:[],currentTask:null,tasksToRemove:new Set,taskIndex:0}})}mount(t,e,s){return this.$context=t,this.$parent=e,this.$barrage=s,this._mounted&&this._mounted(),this}update(){this.$tick+=1;const t=this.__updater__;t.tasks=t.tasks.filter(e=>!t.tasksToRemove.has(e.id));const e=t.tasks;if(t.tasksToRemove.clear(),e.forEach(e=>{t.currentTask=e.id,e.callback.call(this,this.$tick),e.preserve||t.tasksToRemove.add(e.id)}),t.tasks.length>r.default.scheduleLimit)throw new Error(`The amount of scheduled tasks (${t.tasks.length}) is beyond the limit!`)}setTask(t,e=1/0,s=!0){const i=++this.__updater__.taskIndex;return this.__updater__.tasks.splice(e,0,{callback:t,preserve:s,id:i}),i}setTimeout(t,e){return t+=this.$tick,this.setTask(()=>{this.$tick<=t||(e.call(this,this.$tick),this.removeTask())},0)}setInterval(t,...e){if(t<=0)throw new Error(`The interval ${t} should be positive.`);const s=e.length>1?e[0]:1/0,i=e.length>2?e[1]:0,r=e[e.length-1],n=this.$tick+i;return this.setTask(e=>{e-=n;const i=Math.floor(e/t),o=i*t-e;if(i>0&&o>=0&&o<t&&(r.call(this,this.$tick,i),i>=s))return this.removeTask()},0)}removeTask(t=this.__updater__.currentTask){t&&this.__updater__.tasksToRemove.add(t)}}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(0)),n=s(25);class o{constructor(){this._map={},this._data={}}async _load(t){if(!(t in this._data)){const e=fetch(n.resolve(r.default.publicPath,t)).then(this._resolve);this._data[t]={promise:e}}const e=this._data[t];if(1===e.state)return e.value;if(2!==e.state)try{const t=await e.promise;return e.state=1,e.value=t}catch(t){e.error=t,e.state=2}}async load(t={}){return"string"==typeof t?this._load(t):(Object.assign(this._map,t),Promise.all(Object.keys(t).map(e=>this._load(t[e]))))}_get(t){if(!(t in this._map))throw new Error(`Asset ${t} has not been registered.`);return this._data[this._map[t]]}get(...t){return t.map(t=>{const e=this._get(t);if(1!==e.state)throw new Error(`Asset ${t} has not been loaded.`);return e.value})}async check(...t){await Promise.all(t.map(t=>this._get(t).promise))}}class a extends o{async _resolve(t){const e=await t.blob();return await createImageBitmap(e)}}e.ImageManager=a,e.images=new a,e.loadImages=async function(t){return e.images.load(t)},e.default=new class{constructor(){this.images=e.images}async load(t={}){return Promise.all([this.images.load(t.images)])}}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(0)),n=i(s(11)),o=i(s(2)),a=i(s(8));e.default=class extends a.default{constructor(t={}){super(),this._pointCounter=0,this.$refs={},this.$bullets=[],this._mutateHook=t.mutate,this._mountedHook=t.mounted,this._references=t.reference||{},Object.assign(this,t.methods);const e="function"==typeof t.state?t.state.call(this):t.state;Object.assign(this,e)}_mounted(){"function"==typeof this._mountedHook&&this._mountedHook(),"function"==typeof this._mutateHook&&this.setTask(this._mutateHook);for(const t of Object.keys(this._references))this.setRefPoint(t,this._references[t]);this.setTask(()=>{for(const t in this.$refs){const e=this.$refs[t];e.$parent===this&&e.update()}if(this.$bullets.forEach(t=>t.update()),this.$bullets.length>r.default.maxBulletCount)throw new Error(`The amount of bullets ${this.$bullets.length} is beyond the limit!`)})}render(){for(const t in this.$refs){const e=this.$refs[t];e.$parent===this&&e.render()}this.$bullets.forEach(t=>t.render())}setRefPoint(...t){const e=t[t.length-1],s=t.length>1?t[0]:++this._pointCounter;return this.$refs[s]=new o.default(e),this.$refs[s].mount(this.$context,this,this),s}removeRefPoint(t){return delete this.$refs[t]}emitBullets(...t){const e=t.length>2?t[0]:0,s=t.length>1?t.length>2?t[1]:t[0]:1,i=t.length>3?t[2]:1,r=t[t.length-1];for(let t=e;t<s;t+=i){const e="function"==typeof r?r.call(this,t):r,s=new n.default(e);s.$id=++this._pointCounter;for(const t in this.$refs)s.$refs[t]=this.$refs[t].$coord;s.mount(this.$context,this,this);const i=this.$bullets.findIndex(({layer:t})=>t>s.layer);i<0?this.$bullets.push(s):this.$bullets.splice(i,0,s)}}}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(0)),n=i(s(6)),o=s(1),a=i(s(7)),h=i(s(2));e.default=class extends h.default{constructor(t={}){super(t),this.$refs={},this.grazing={active:!1},this.layer=void 0===t.layer?0:t.layer,this.judgeType=void 0===t.judgeType?"ortho":t.judgeType,this.fieldType=void 0===t.fieldType?"viewport":t.fieldType,this.setTask(t=>{const e=n.default.judges.resolve(this.judgeType);if(e&&this.$player)if(e.call(this,this.$player))this.hitPlayer();else{if(this.grazing.end)return;e.call(this,this.$player,this.$player.grazeRadius)?(this.grazing.active=!0,this.grazing.birth?t-this.grazing.birth>r.default.grazeTimeout&&(this.grazing.end=!0,this.$player.grazeCount+=r.default.grazeBonus):(this.grazing.birth=t,this.$player.grazeCount+=1)):(this.grazing.active=!1,this.grazing.birth=null)}const s=n.default.fields.resolve(this.fieldType);s&&s.call(this,t)&&this.destroy()});const e=t.origin||"origin";this._mountedHook.unshift(()=>{this.$origin=this._resolvePoint(e)})}render(){if(!this.$context||"function"!=typeof this._displayHook)return;let t="";this.grazing.active&&(t+=r.default.grazeFilter),this.$context.filter=t||"none",this._displayHook.call(this,this.$displayTick),this.$context.filter="none"}setOrigin(t){t=this._resolvePoint(t);const e=a.default.from(t).locate(this.$coord);return this.x=e.x,this.y=e.y,this.face=e.face,this.$origin=t,e}_resolvePoint(t){return"string"!=typeof t?t:this.$refs[t]?this.$refs[t]:(r.default.showWarning&&console.warn(`Warning: reference point ${t} is not found.`),{x:0,y:0,face:0})}get $coord(){return this._coordinate&&this.$tick===this._coordinate.$birth||(this._coordinate=a.default.from(this.$origin).resolve(this),this._coordinate.$birth=this.$tick),this._coordinate}polarLocate(t=this.rho,e=this.theta){this.x=t*o.math.cos(r.default.angleUnit*e),this.y=t*o.math.sin(r.default.angleUnit*e)}hitPlayer(){this.$player.lifeCount-=1,this.$player.deathCount+=1,this.destroy()}destroy(){const t=this.$id;this.$barrage.setTimeout(0,function(){const e=this.$bullets.findIndex(e=>e.$id===t);e>=0&&this.$bullets.splice(e,1)})}}},function(t,e,s){"use strict";function i(){}Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t={}){this.initialize(t)}initialize(t={}){"__loop__"in this&&(t=Object.assign(this.__loop__.options,t));const e={options:t,frameId:null,frameCount:0,lastFrame:null,totalStop:0,lastStop:null,recentData:[],timeLine:null,lastModifyStats:0,skipRate:1+(t.skipFrame||0),tickLength:1e3/(t.tickRate||60),tickStorage:t.tickStorage||60,statsInterval:t.statsInterval||1/0,maxInterpolation:t.maxInterpolation||5};return e.sampleTime=e.tickLength*e.tickStorage,Object.defineProperty(this,"__loop__",{value:e}),this.onPause=t.onPause||this.onPause||i,this.onResume=t.onResume||this.onResume||i,this.onStats=t.onStats||this.onStats||i,this.onError=t.onError||this.onError||i,this}pause(){this.__loop__.frameId&&(this.__loop__.lastStop=performance.now(),cancelAnimationFrame(this.__loop__.frameId),this.__loop__.frameId=null,this.onPause())}resume(){if(!this.__loop__.frameId){if(this.__loop__.lastStop){const t=performance.now()-this.__loop__.lastStop;this.__loop__.totalStop+=t,this.__loop__.lastFrame&&(this.__loop__.lastFrame+=t)}this.__loop__.frameId=requestAnimationFrame(t=>this._render(t)),this.onResume()}}toggle(){null!==this.__loop__.frameId?this.pause():this.resume()}getStatus(){const{recentData:t}=this.__loop__;if(!t.length)return null;let e=0,s=0,i=0;for(const r of t)e+=r.time,s+=r.ticks,i+=Number(1!==r.ticks);return{tickRate:1e3/e*s,frameRate:1e3/e*t.length,dropRate:i/t.length}}_render(t){const e=this.__loop__;let s=(t-e.totalStop-e.timeLine)/e.tickLength;(s=s<1?Math.round(s):Math.floor(s))>e.maxInterpolation?(s=e.maxInterpolation,e.timeLine=t-e.totalStop):e.timeLine+=s*e.tickLength;const i=t-(e.lastFrame||0);e.lastFrame&&(e.recentData.unshift({time:i,ticks:s}),e.recentData=e.recentData.slice(0,e.tickStorage)),e.lastFrame=t;try{for(let t=0;t<s;t+=1)this.update();s&&(e.frameCount%e.skipRate==0&&this.render(),e.frameCount+=1)}catch(t){return console.error(t),this.onError(t),void this.pause()}e.frameId=requestAnimationFrame(t=>this._render(t));const r=performance.now();if(r-e.lastModifyStats<e.statsInterval)return;e.lastModifyStats=r;const n=this.getStatus();n&&this.onStats(n)}}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(1),n=i(s(2)),o=i(s(0));e.default=class extends n.default{constructor(t={}){t.state={color:"red",radius:4,lifeCount:8,judgeRadius:3,grazeRadius:24,bombCount:0,highSpeed:4.5,lowSpeed:2,...t.state},super(t),this.deathCount=0,this.grazeCount=0,this._listeners=[],this.spin=-o.default.angleUnit/r.math.twoPI,this.control=void 0===t.control?"keyboard":t.control}_listen(t,e,s,i){t.addEventListener(e,s,i),this._listeners.push([t,e,s,i])}_mounted(){this.x=this.$context.canvas.width/2,this.y=this.$context.canvas.height/8*7,this._mountedHook.forEach(t=>t.call(this)),this.render(),this.setTask(this._mutate),"mouse"===this.control?(this._mouseState={x:0,y:0},this.$parent.onMouseMove=(t=>{this._mouseState.x=t.clientX/this.$context.canvas.clientWidth*this.$context.canvas.width,this._mouseState.y=t.clientY/this.$context.canvas.clientHeight*this.$context.canvas.height,t.preventDefault(),t.stopPropagation()})):"keyboard"===this.control&&(this._keyState={ArrowUp:0,ArrowDown:0,ArrowLeft:0,ArrowRight:0,Shift:0},this._listen(window,"keydown",t=>{t.key in this._keyState&&(this._keyState[t.key]=1,t.preventDefault(),t.stopPropagation())}),this._listen(window,"keyup",t=>{t.key in this._keyState&&(this._keyState[t.key]=0,t.preventDefault(),t.stopPropagation())}))}_mutate(t){if(this._mutateHook.forEach(e=>e.call(this,t)),"mouse"===this.control)this.x=this._mouseState.x,this.y=this._mouseState.y;else if("keyboard"===this.control){const t=(this._keyState.Shift?this.lowSpeed:this.highSpeed)/Math.sqrt((this._keyState.ArrowDown^this._keyState.ArrowUp)+(this._keyState.ArrowLeft^this._keyState.ArrowRight)||1);this.x+=t*this._keyState.ArrowRight,this.x-=t*this._keyState.ArrowLeft,this.y+=t*this._keyState.ArrowDown,this.y-=t*this._keyState.ArrowUp}}update(){super.update();const{left:t,right:e,bottom:s,top:i}=this.$parent.movingScope;this.x<t&&(this.x=t),this.y<i&&(this.y=i),this.x>e&&(this.x=e),this.y>s&&(this.y=s)}renderBelow(){this.$context&&"function"==typeof this._displayHook&&this._displayHook.call(this,this.$displayTick)}renderAbove(){if(!this._keyState.Shift)return;const t=this.getGradient("white",this.radius/2);this.fillCircle(t)}destory(){this._listeners.forEach(([t,e,s,i])=>{t.removeEventListener(e,s,i)})}}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(5));e.default=function(t,e=function(t){let e=t.length-1,s=String(t[e]);for(;--e>=0;)s+=""+t[e];return s}){let s=1,i=0,n=0;const o={},a={};function h(t){if(delete o[t],t===s)for(;!o.hasOwnProperty(++s);)continue}return(...l)=>{const u=e(l.slice(0,t.length)),c=a[u],f=++n;if(o[f]=u,c)return h(c.index),c.index=f,c.value;{const e=t(...l);return a[u]={index:f,value:e},(i+=1)<=r.default.cacheSize?e:(delete a[o[s]],i-=1,h(s),e)}}}},function(t,e,s){"use strict";e.decode=e.parse=s(30),e.encode=e.stringify=s(31)},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(17),n=i(s(12)),o=i(s(10)),a=i(s(13));e.default=class extends n.default{constructor(t,e={}){super(e),this.element=t,t.classList.add("stg-field"),t.style.background=e.background,this.canvas=t.appendChild(document.createElement("canvas")),this.canvas.height=e.height||560,this.canvas.width=e.width||480,this.context=this.canvas.getContext("2d"),this.control=e.control,this.setTitleStyle(e.titleStyle);const{borderHeight:s=18,borderWidth:i=9}=e;this.movingScope={left:i,top:s,right:this.canvas.width-i,bottom:this.canvas.height-s},void 0===this.control&&(this.control="keyboard"),this.control&&this.element.classList.add("use-"+this.control),t.addEventListener("mousemove",t=>this.onMouseMove&&this.onMouseMove(t)),t.addEventListener("mousedown",t=>this.onMouseDown&&this.onMouseDown(t)),t.addEventListener("mouseup",t=>this.onMouseUp&&this.onMouseUp(t)),t.addEventListener("click",t=>this.onClick&&this.onClick(t)),this.onClick=(t=>{this.toggle(),t.preventDefault(),t.stopPropagation()})}setTitleStyle(t={}){const e=t.fontSize||24;this.titleStyle={fontSize:e,fontColor:"white",x:this.canvas.width-e,y:e,textAlign:"right",textBaseline:"top",fontFamily:'Calibri, Candara, Segoe, "Segoe UI", Optima, Arial',...t}}async setPlayer(t){t&&(this.removePlayer(),"function"==typeof t.before&&await r.use(t.before),this.player=new a.default({control:this.control,...t}).mount(this.context,this,this.barrage),this.barrage&&(this.barrage.$refs.player=this.player))}removePlayer(){this.player&&(this.player.destory(),this.player=null),this.barrage&&delete this.barrage.$refs.player}async setBarrage(t){t&&(this.pause(),this.clearScreen(),"function"==typeof t.before&&await r.use(t.before),this.barrage=new o.default(t),this.player&&(this.barrage.$refs.player=this.player),this.barrage.mount(this.context,this))}clearScreen(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}clear(){this.pause(),this.removePlayer(),this.clearScreen(),this.barrage=null}update(){this.barrage&&this.barrage.update(),this.player&&this.player.update()}render(){this.clearScreen(),this.player&&this.player.renderBelow(),this.barrage&&this.barrage.render(),this.player&&this.player.renderAbove(),this.showTitle()}showText(t,e){this.context.textAlign=e.textAlign,this.context.textBaseline=e.textBaseline,this.context.fillStyle=e.fontColor,this.context.font=`${e.fontSize||16}px ${e.fontFamily}`,this.context.fillText(t,e.x,e.y)}showTitle(){const t=this.title&&this.titleStyle;t&&this.showText(this.title,t)}}},function(t,e,s){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)Object.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(4)),n=new Set;e.use=function(t,e,s=!0){let i;if("function"==typeof t)i=t;else{if(!t||"function"!=typeof t.install)throw new TypeError('Not a valid plugin. A plugin should be a function or an object with an "install" method.');i=t.install}if(n.has(i))return;const o=i(r,e);return s&&n.add(i),o}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(34));e.templates=r.default;const n=i(s(19));e.bullets=n.default;const o=i(s(43));e.th12=o.default;const a=i(s(44));e.th15=a.default},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(40)),n=i(s(41)),o=i(s(42)),a={bullet1:r.default,bullet2:n.default,bullet3:o.default};e.default=async function(t,e={}){return Promise.all(Object.keys(a).map(async s=>{if(!e[s])return;const i=await t.loadImages(e[s]);t.buildBullet(i,a[s])}))}},function(t){t.exports={a:"0.4.0"}},function(t,e,s){"use strict";s.r(e);var i=s(4),r=s(18);for(var n in s.d(e,"touhou",function(){return r}),i)["touhou","version","default"].indexOf(n)<0&&function(t){s.d(e,t,function(){return i[t]})}(n);var o=s(1);for(var n in o)["touhou","version","default"].indexOf(n)<0&&function(t){s.d(e,t,function(){return o[t]})}(n);var a=s(20);s.d(e,"version",function(){return a.a})},function(t,e,s){"use strict";function i(){return 2*Math.floor(2*Math.random())-1}function r(...t){const e=t.length>1?t[0]:0,s=t[t.length-1];return Math.random()*(s-e)+e}function n(...t){let e=Math.random()*t.reduce((t,e)=>t+e,0);for(let s=0;s<t.length;s+=1)if((e-=t[s])<0)return s}Object.defineProperty(e,"__esModule",{value:!0}),e.pm1=i,e.real=r,e.int=function(...t){return Math.floor(r(...t))},e.choose=n,e.transfer=function(t,e,s,o,a){return t<e+o?t+r(o,a):t>s-o?t-r(o,a):t<e+a?n(t-e-o,a-o)?t+r(o,a):t-r(o,t-e-o):t>s-a?n(s-t-o,a-o)?t-r(o,a):t+r(o,s-t-o):t+r(o,a)*i()}},function(t,e,s){"use strict";function i(t){return(t*=256)>255?255:t<0?0:Math.floor(t)}Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=void 0===i?1:i}blend(t,e=.5){return new r(this.r*(1-e)+t.r*e,this.g*(1-e)+t.g*e,this.b*(1-e)+t.b*e,this.a*(1-e)+t.a*e)}darker(t=.5){return new r(this.r*(1-t),this.g*(1-t),this.b*(1-t),this.a)}lighter(t=.5){return new r(1-(1-this.r)*(1-t),1-(1-this.g)*(1-t),1-(1-this.b)*(1-t),this.a)}inverse(){return new r(1-this.r,1-this.g,1-this.b,this.a)}alpha(t){return new r(this.r,this.g,this.b,t)}opacify(t){return new r(this.r,this.g,this.b,1-(1-this.a)*(1-t))}transparentize(t){return new r(this.r,this.g,this.b,this.a*(1-t))}toString(){return`rgba(${i(this.r)},${i(this.g)},${i(this.b)},${this.a})`}static rgba(t,e,s,i){return new r(t,e,s,i)}static hsla(t,e=1,s=1,i){const n=(t>=0?t%2:t%2+2)/2,o=n-1/3>0?n-1/3:n+2/3,a=s<.5?s*(1+e):s+e-s*e,h=2*s-a,l=t=>t>=2/3?h:t>=.5?h+6*(a-h)*(2/3-t):t>=1/6?a:h+6*(a-h)*t;return new r(l(n+1/3>1?n-2/3:n+1/3),l(n),l(o),i)}static hsva(t,e=1,s=1,i){const n=3*t,o=n-Math.floor(n),a=s*(1-e),h=s*(1-o*e),l=s*(1-(1-o)*e);switch(Math.floor(n>=0?n%6:n%6+6)){case 0:return new r(s,l,a,i);case 1:return new r(h,s,a,i);case 2:return new r(a,s,l,i);case 3:return new r(a,h,s,i);case 4:return new r(l,a,s,i);case 5:return new r(s,a,h,i)}}static hex(t){return"#"===t.charAt(0)&&(t=t.slice(1)),3===t.length||4===t.length?new r(parseInt(t.charAt(0),16)/16,parseInt(t.charAt(1),16)/16,parseInt(t.charAt(2),16)/16,parseInt(t.charAt(3),16)/16):6===t.length||8===t.length?new r(parseInt(t.slice(0,2),16)/256,parseInt(t.slice(2,4),16)/256,parseInt(t.slice(4,6),16)/256,parseInt(t.slice(6,8),16)/256):void 0}static blend(...t){let e=new r(0,0,0),s=1;for(let i=0;i<t.length;i+=2){const r=t[i+1]||s;e.r+=t[i].r*r,e.g+=t[i].g*r,e.b+=t[i].b*r,e.a+=t[i].a*r,s-=t[i+1]}return e}}r.scheme4=["red","blue","green","yellow"],r.scheme8=["black","red","magenta","blue","cyan","green","yellow","gray"],r.scheme16=["black","maroon","red","purple","magenta","darkblue","blue","darkcyan","cyan","darkgreen","green","yellowgreen","darkyellow","yellow","orange","gray"],r.fallback={maroon:"red",purple:"magenta",darkblue:"blue",darkcyan:"cyan",darkgreen:"green",yellowgreen:"green",darkyellow:"yellow",orange:"yellow"},r.builtin={transparent:new r(0,0,0,0),aliceblue:r.hex("#f0f8ff"),antiquewhite:r.hex("#faebd7"),aqua:r.hex("#00ffff"),aquamarine:r.hex("#7fffd4"),azure:r.hex("#f0ffff"),beige:r.hex("#f5f5dc"),bisque:r.hex("#ffe4c4"),black:r.hex("#000000"),blanchedalmond:r.hex("#ffebcd"),blue:r.hex("#0000ff"),blueviolet:r.hex("#8a2be2"),brown:r.hex("#a52a2a"),burlywood:r.hex("#deb887"),cadetblue:r.hex("#5f9ea0"),chartreuse:r.hex("#7fff00"),chocolate:r.hex("#d2691e"),coral:r.hex("#ff7f50"),cornflowerblue:r.hex("#6495ed"),cornsilk:r.hex("#fff8dc"),crimson:r.hex("#dc143c"),cyan:r.hex("#00ffff"),darkblue:r.hex("#00008b"),darkcyan:r.hex("#008b8b"),darkgoldenrod:r.hex("#b8860b"),darkgray:r.hex("#a9a9a9"),darkgreen:r.hex("#006400"),darkkhaki:r.hex("#bdb76b"),darkmagenta:r.hex("#8b008b"),darkolivegreen:r.hex("#556b2f"),darkorange:r.hex("#ff8c00"),darkorchid:r.hex("#9932cc"),darkred:r.hex("#8b0000"),darksalmon:r.hex("#e9967a"),darkseagreen:r.hex("#8fbc8f"),darkslateblue:r.hex("#483d8b"),darkslategray:r.hex("#2f4f4f"),darkturquoise:r.hex("#00ced1"),darkviolet:r.hex("#9400d3"),deeppink:r.hex("#ff1493"),deepskyblue:r.hex("#00bfff"),dimgray:r.hex("#696969"),dodgerblue:r.hex("#1e90ff"),feldspar:r.hex("#d19275"),firebrick:r.hex("#b22222"),floralwhite:r.hex("#fffaf0"),forestgreen:r.hex("#228b22"),fuchsia:r.hex("#ff00ff"),gainsboro:r.hex("#dcdcdc"),ghostwhite:r.hex("#f8f8ff"),gold:r.hex("#ffd700"),goldenrod:r.hex("#daa520"),gray:r.hex("#808080"),green:r.hex("#008000"),greenyellow:r.hex("#adff2f"),honeydew:r.hex("#f0fff0"),hotpink:r.hex("#ff69b4"),indianred:r.hex("#cd5c5c"),indigo:r.hex("#4b0082"),ivory:r.hex("#fffff0"),khaki:r.hex("#f0e68c"),lavender:r.hex("#e6e6fa"),lavenderblush:r.hex("#fff0f5"),lawngreen:r.hex("#7cfc00"),lemonchiffon:r.hex("#fffacd"),lightblue:r.hex("#add8e6"),lightcoral:r.hex("#f08080"),lightcyan:r.hex("#e0ffff"),lightgoldenrodyellow:r.hex("#fafad2"),lightgrey:r.hex("#d3d3d3"),lightgreen:r.hex("#90ee90"),lightpink:r.hex("#ffb6c1"),lightsalmon:r.hex("#ffa07a"),lightseagreen:r.hex("#20b2aa"),lightskyblue:r.hex("#87cefa"),lightslateblue:r.hex("#8470ff"),lightslategray:r.hex("#778899"),lightsteelblue:r.hex("#b0c4de"),lightyellow:r.hex("#ffffe0"),lime:r.hex("#00ff00"),limegreen:r.hex("#32cd32"),linen:r.hex("#faf0e6"),magenta:r.hex("#ff00ff"),maroon:r.hex("#800000"),mediumaquamarine:r.hex("#66cdaa"),mediumblue:r.hex("#0000cd"),mediumorchid:r.hex("#ba55d3"),mediumpurple:r.hex("#9370d8"),mediumseagreen:r.hex("#3cb371"),mediumslateblue:r.hex("#7b68ee"),mediumspringgreen:r.hex("#00fa9a"),mediumturquoise:r.hex("#48d1cc"),mediumvioletred:r.hex("#c71585"),midnightblue:r.hex("#191970"),mintcream:r.hex("#f5fffa"),mistyrose:r.hex("#ffe4e1"),moccasin:r.hex("#ffe4b5"),navajowhite:r.hex("#ffdead"),navy:r.hex("#000080"),oldlace:r.hex("#fdf5e6"),olive:r.hex("#808000"),olivedrab:r.hex("#6b8e23"),orange:r.hex("#ffa500"),orangered:r.hex("#ff4500"),orchid:r.hex("#da70d6"),palegoldenrod:r.hex("#eee8aa"),palegreen:r.hex("#98fb98"),paleturquoise:r.hex("#afeeee"),palevioletred:r.hex("#d87093"),papayawhip:r.hex("#ffefd5"),peachpuff:r.hex("#ffdab9"),peru:r.hex("#cd853f"),pink:r.hex("#ffc0cb"),plum:r.hex("#dda0dd"),powderblue:r.hex("#b0e0e6"),purple:r.hex("#800080"),red:r.hex("#ff0000"),rosybrown:r.hex("#bc8f8f"),royalblue:r.hex("#4169e1"),saddlebrown:r.hex("#8b4513"),salmon:r.hex("#fa8072"),sandybrown:r.hex("#f4a460"),seagreen:r.hex("#2e8b57"),seashell:r.hex("#fff5ee"),sienna:r.hex("#a0522d"),silver:r.hex("#c0c0c0"),skyblue:r.hex("#87ceeb"),slateblue:r.hex("#6a5acd"),slategray:r.hex("#708090"),snow:r.hex("#fffafa"),springgreen:r.hex("#00ff7f"),steelblue:r.hex("#4682b4"),tan:r.hex("#d2b48c"),teal:r.hex("#008080"),thistle:r.hex("#d8bfd8"),tomato:r.hex("#ff6347"),turquoise:r.hex("#40e0d0"),violet:r.hex("#ee82ee"),violetred:r.hex("#d02090"),wheat:r.hex("#f5deb3"),white:r.hex("#ffffff"),whitesmoke:r.hex("#f5f5f5"),yellow:r.hex("#ffff00"),yellowgreen:r.hex("#9acd32")},e.default=r},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(14)),n=i(s(5)),o={};Object.defineProperty(o,"twoPI",{value:2*Math.PI}),Object.defineProperty(o,"halfPI",{value:Math.PI/2}),Object.defineProperty(o,"csc",{value:t=>1/o.sin(t)}),Object.defineProperty(o,"sec",{value:t=>1/o.cos(t)}),Object.defineProperty(o,"cot",{value:t=>1/o.tan(t)}),Object.defineProperty(o,"ge",{value:(t,e)=>t>=e-n.default.minValue}),Object.defineProperty(o,"le",{value:(t,e)=>e>=t-n.default.minValue}),Object.defineProperty(o,"gt",{value:(t,e)=>t>e+n.default.minValue}),Object.defineProperty(o,"lt",{value:(t,e)=>e>t+n.default.minValue}),Object.defineProperty(o,"eq",{value:(t,e)=>Math.abs(t-e)<=n.default.minValue}),Object.defineProperty(o,"neq",{value:(t,e)=>Math.abs(t-e)>n.default.minValue}),Object.defineProperty(o,"sign",{value:t=>t>n.default.minValue?1:t<-n.default.minValue?-1:0});const a=["sin","cos","tan","sign"],h=["sqrt","cbrt","exp","log","log2","log10","asin","acos","atan","sinh","cosh","tanh","asinh","acosh","atanh"];Object.getOwnPropertyNames(Math).forEach(t=>{a.includes(t)||Object.defineProperty(o,t,{value:h.includes(t)?r.default(Math[t]):Math[t]})});const l=t=>([e])=>(e%t).toFixed(6);Object.defineProperty(o,"sin",{value:r.default(Math.sin,l(o.twoPI))}),Object.defineProperty(o,"cos",{value:r.default(Math.cos,l(o.twoPI))}),Object.defineProperty(o,"tan",{value:r.default(Math.tan,l(o.PI))}),e.default=o},function(t,e,s){"use strict";var i=s(26),r=s(29);function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=b,e.resolve=function(t,e){return b(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?b(t,!1,!0).resolveObject(e):e},e.format=function(t){r.isString(t)&&(t=b(t));return t instanceof n?t.format():n.prototype.format.call(t)},e.Url=n;var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(l),c=["%","/","?",";","#"].concat(u),f=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=s(15);function b(t,e,s){if(t&&r.isObject(t)&&t instanceof n)return t;var i=new n;return i.parse(t,e,s),i}n.prototype.parse=function(t,e,s){if(!r.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),a=-1!==n&&n<t.indexOf("#")?"?":"#",l=t.split(a);l[0]=l[0].replace(/\\/g,"/");var b=t=l.join(a);if(b=b.trim(),!s&&1===t.split("#").length){var x=h.exec(b);if(x)return this.path=b,this.href=b,this.pathname=x[1],x[2]?(this.search=x[2],this.query=e?_.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var v=o.exec(b);if(v){var w=(v=v[0]).toLowerCase();this.protocol=w,b=b.substr(v.length)}if(s||v||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var k="//"===b.substr(0,2);!k||v&&m[v]||(b=b.substr(2),this.slashes=!0)}if(!m[v]&&(k||v&&!y[v])){for(var $,j,O=-1,P=0;P<f.length;P++){-1!==(M=b.indexOf(f[P]))&&(-1===O||M<O)&&(O=M)}-1!==(j=-1===O?b.lastIndexOf("@"):b.lastIndexOf("@",O))&&($=b.slice(0,j),b=b.slice(j+1),this.auth=decodeURIComponent($)),O=-1;for(P=0;P<c.length;P++){var M;-1!==(M=b.indexOf(c[P]))&&(-1===O||M<O)&&(O=M)}-1===O&&(O=b.length),this.host=b.slice(0,O),b=b.slice(O),this.parseHost(),this.hostname=this.hostname||"";var S="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!S)for(var C=this.hostname.split(/\./),I=(P=0,C.length);P<I;P++){var T=C[P];if(T&&!T.match(d)){for(var A="",R=0,E=T.length;R<E;R++)T.charCodeAt(R)>127?A+="x":A+=T[R];if(!A.match(d)){var q=C.slice(0,P),z=C.slice(P+1),U=T.match(p);U&&(q.push(U[1]),z.unshift(U[2])),z.length&&(b="/"+z.join(".")+b),this.hostname=q.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),S||(this.hostname=i.toASCII(this.hostname));var D=this.port?":"+this.port:"",H=this.hostname||"";this.host=H+D,this.href+=this.host,S&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!g[w])for(P=0,I=u.length;P<I;P++){var L=u[P];if(-1!==b.indexOf(L)){var F=encodeURIComponent(L);F===L&&(F=escape(L)),b=b.split(L).join(F)}}var B=b.indexOf("#");-1!==B&&(this.hash=b.substr(B),b=b.slice(0,B));var N=b.indexOf("?");if(-1!==N?(this.search=b.substr(N),this.query=b.substr(N+1),e&&(this.query=_.parse(this.query)),b=b.slice(0,N)):e&&(this.search="",this.query={}),b&&(this.pathname=b),y[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){D=this.pathname||"";var V=this.search||"";this.path=D+V}return this.href=this.format(),this},n.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",s=this.pathname||"",i=this.hash||"",n=!1,o="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&r.isObject(this.query)&&Object.keys(this.query).length&&(o=_.stringify(this.query));var a=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||y[e])&&!1!==n?(n="//"+(n||""),s&&"/"!==s.charAt(0)&&(s="/"+s)):n||(n=""),i&&"#"!==i.charAt(0)&&(i="#"+i),a&&"?"!==a.charAt(0)&&(a="?"+a),e+n+(s=s.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace("#","%23"))+i},n.prototype.resolve=function(t){return this.resolveObject(b(t,!1,!0)).format()},n.prototype.resolveObject=function(t){if(r.isString(t)){var e=new n;e.parse(t,!1,!0),t=e}for(var s=new n,i=Object.keys(this),o=0;o<i.length;o++){var a=i[o];s[a]=this[a]}if(s.hash=t.hash,""===t.href)return s.href=s.format(),s;if(t.slashes&&!t.protocol){for(var h=Object.keys(t),l=0;l<h.length;l++){var u=h[l];"protocol"!==u&&(s[u]=t[u])}return y[s.protocol]&&s.hostname&&!s.pathname&&(s.path=s.pathname="/"),s.href=s.format(),s}if(t.protocol&&t.protocol!==s.protocol){if(!y[t.protocol]){for(var c=Object.keys(t),f=0;f<c.length;f++){var d=c[f];s[d]=t[d]}return s.href=s.format(),s}if(s.protocol=t.protocol,t.host||m[t.protocol])s.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),s.pathname=p.join("/")}if(s.search=t.search,s.query=t.query,s.host=t.host||"",s.auth=t.auth,s.hostname=t.hostname||t.host,s.port=t.port,s.pathname||s.search){var g=s.pathname||"",_=s.search||"";s.path=g+_}return s.slashes=s.slashes||t.slashes,s.href=s.format(),s}var b=s.pathname&&"/"===s.pathname.charAt(0),x=t.host||t.pathname&&"/"===t.pathname.charAt(0),v=x||b||s.host&&t.pathname,w=v,k=s.pathname&&s.pathname.split("/")||[],$=(p=t.pathname&&t.pathname.split("/")||[],s.protocol&&!y[s.protocol]);if($&&(s.hostname="",s.port=null,s.host&&(""===k[0]?k[0]=s.host:k.unshift(s.host)),s.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),v=v&&(""===p[0]||""===k[0])),x)s.host=t.host||""===t.host?t.host:s.host,s.hostname=t.hostname||""===t.hostname?t.hostname:s.hostname,s.search=t.search,s.query=t.query,k=p;else if(p.length)k||(k=[]),k.pop(),k=k.concat(p),s.search=t.search,s.query=t.query;else if(!r.isNullOrUndefined(t.search)){if($)s.hostname=s.host=k.shift(),(S=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=S.shift(),s.host=s.hostname=S.shift());return s.search=t.search,s.query=t.query,r.isNull(s.pathname)&&r.isNull(s.search)||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.href=s.format(),s}if(!k.length)return s.pathname=null,s.search?s.path="/"+s.search:s.path=null,s.href=s.format(),s;for(var j=k.slice(-1)[0],O=(s.host||t.host||k.length>1)&&("."===j||".."===j)||""===j,P=0,M=k.length;M>=0;M--)"."===(j=k[M])?k.splice(M,1):".."===j?(k.splice(M,1),P++):P&&(k.splice(M,1),P--);if(!v&&!w)for(;P--;P)k.unshift("..");!v||""===k[0]||k[0]&&"/"===k[0].charAt(0)||k.unshift(""),O&&"/"!==k.join("/").substr(-1)&&k.push("");var S,C=""===k[0]||k[0]&&"/"===k[0].charAt(0);$&&(s.hostname=s.host=C?"":k.length?k.shift():"",(S=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=S.shift(),s.host=s.hostname=S.shift()));return(v=v||s.host&&k.length)&&!C&&k.unshift(""),k.length?s.pathname=k.join("/"):(s.pathname=null,s.path=null),r.isNull(s.pathname)&&r.isNull(s.search)||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.auth=t.auth||s.auth,s.slashes=s.slashes||t.slashes,s.href=s.format(),s},n.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e,s){(function(t,i){var r;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(n){e&&e.nodeType,t&&t.nodeType;var o="object"==typeof i&&i;o.global!==o&&o.window!==o&&o.self;var a,h=2147483647,l=36,u=1,c=26,f=38,d=700,p=72,g=128,m="-",y=/^xn--/,_=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=l-u,w=Math.floor,k=String.fromCharCode;function $(t){throw new RangeError(x[t])}function j(t,e){for(var s=t.length,i=[];s--;)i[s]=e(t[s]);return i}function O(t,e){var s=t.split("@"),i="";return s.length>1&&(i=s[0]+"@",t=s[1]),i+j((t=t.replace(b,".")).split("."),e).join(".")}function P(t){for(var e,s,i=[],r=0,n=t.length;r<n;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<n?56320==(64512&(s=t.charCodeAt(r++)))?i.push(((1023&e)<<10)+(1023&s)+65536):(i.push(e),r--):i.push(e);return i}function M(t){return j(t,function(t){var e="";return t>65535&&(e+=k((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=k(t)}).join("")}function S(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function C(t,e,s){var i=0;for(t=s?w(t/d):t>>1,t+=w(t/e);t>v*c>>1;i+=l)t=w(t/v);return w(i+(v+1)*t/(t+f))}function I(t){var e,s,i,r,n,o,a,f,d,y,_,b=[],x=t.length,v=0,k=g,j=p;for((s=t.lastIndexOf(m))<0&&(s=0),i=0;i<s;++i)t.charCodeAt(i)>=128&&$("not-basic"),b.push(t.charCodeAt(i));for(r=s>0?s+1:0;r<x;){for(n=v,o=1,a=l;r>=x&&$("invalid-input"),((f=(_=t.charCodeAt(r++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:l)>=l||f>w((h-v)/o))&&$("overflow"),v+=f*o,!(f<(d=a<=j?u:a>=j+c?c:a-j));a+=l)o>w(h/(y=l-d))&&$("overflow"),o*=y;j=C(v-n,e=b.length+1,0==n),w(v/e)>h-k&&$("overflow"),k+=w(v/e),v%=e,b.splice(v++,0,k)}return M(b)}function T(t){var e,s,i,r,n,o,a,f,d,y,_,b,x,v,j,O=[];for(b=(t=P(t)).length,e=g,s=0,n=p,o=0;o<b;++o)(_=t[o])<128&&O.push(k(_));for(i=r=O.length,r&&O.push(m);i<b;){for(a=h,o=0;o<b;++o)(_=t[o])>=e&&_<a&&(a=_);for(a-e>w((h-s)/(x=i+1))&&$("overflow"),s+=(a-e)*x,e=a,o=0;o<b;++o)if((_=t[o])<e&&++s>h&&$("overflow"),_==e){for(f=s,d=l;!(f<(y=d<=n?u:d>=n+c?c:d-n));d+=l)j=f-y,v=l-y,O.push(k(S(y+j%v,0))),f=w(j/v);O.push(k(S(f,0))),n=C(s,x,i==r),s=0,++i}++s,++e}return O.join("")}a={version:"1.4.1",ucs2:{decode:P,encode:M},decode:I,encode:T,toASCII:function(t){return O(t,function(t){return _.test(t)?"xn--"+T(t):t})},toUnicode:function(t){return O(t,function(t){return y.test(t)?I(t.slice(4).toLowerCase()):t})}},void 0===(r=function(){return a}.call(e,s,e,t))||(t.exports=r)}()}).call(this,s(27)(t),s(28))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(t){"object"==typeof window&&(s=window)}t.exports=s},function(t,e,s){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e,s){"use strict";function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,s,n){e=e||"&",s=s||"=";var o={};if("string"!=typeof t||0===t.length)return o;var a=/\+/g;t=t.split(e);var h=1e3;n&&"number"==typeof n.maxKeys&&(h=n.maxKeys);var l=t.length;h>0&&l>h&&(l=h);for(var u=0;u<l;++u){var c,f,d,p,g=t[u].replace(a,"%20"),m=g.indexOf(s);m>=0?(c=g.substr(0,m),f=g.substr(m+1)):(c=g,f=""),d=decodeURIComponent(c),p=decodeURIComponent(f),i(o,d)?r(o[d])?o[d].push(p):o[d]=[o[d],p]:o[d]=p}return o};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,s){"use strict";var i=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,s,a){return e=e||"&",s=s||"=",null===t&&(t=void 0),"object"==typeof t?n(o(t),function(o){var a=encodeURIComponent(i(o))+s;return r(t[o])?n(t[o],function(t){return a+encodeURIComponent(i(t))}).join(e):a+encodeURIComponent(i(t[o]))}).join(e):a?encodeURIComponent(i(a))+s+encodeURIComponent(i(t)):""};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function n(t,e){if(t.map)return t.map(e);for(var s=[],i=0;i<t.length;i++)s.push(e(t[i],i));return s}var o=Object.keys||function(t){var e=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.push(s);return e}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={distant(){const{width:t,height:e}=this.$context.canvas;return this.x**2+this.y**2>t**2+e**2},timing(t){return t>(this.lifeSpan||12e3)},viewport(){const{x:t,y:e}=this.$coord,{width:s,height:i}=this.$context.canvas,r=this.fieldBorder||10;return e<-r||e>i+r||t<-r||t>s+r}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={ortho(t,e=t.judgeRadius){return this.$coord.dist2(t)<e**2+this.judgeRadius**2},square(t,e=t.judgeRadius){const s=e+this.judgeRadius,i=this.$coord.locate(t.x,t.y);return Math.abs(i.x)<s||Math.abs(i.y)<s},viewport(t,e=t.judgeRadius){const s=e+this.judgeRadius;return this.$coord.dist2(t)<s**2}}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(35)),n=i(s(36)),o=i(s(37)),a=i(s(38)),h=i(s(39));e.default=function(t){t.defineTemplate({flaming:r.default,large:n.default,medium:o.default,small:a.default,ellipse:h.default})}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={applied(){this.radius=6,this.innerRadius=4,this.judgeRadius=4,this.color=this.color||"blue",this.innerColor=this.innerColor||"white"},display(){this.fillCircle(this.getGradient(this.color,this.innerR,this.bdColor))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={applied(){this.radius=20,this.innerRadius=14,this.judgeRadius=8.5,this.color=this.color||"blue",this.innerColor=this.innerColor||"white"},display(){this.fillCircle(this.getGradient(this.innerColor,this.innerRadius))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={applied(){this.radius=14,this.innerRadius=8.5,this.judgeRadius=9,this.color=this.color||"blue",this.innerColor=this.innerColor||"white"},display(){this.fillCircle(this.getGradient(this.innerColor,this.innerRadius))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={applied(){this.radius=6,this.innerRadius=4,this.judgeRadius=4,this.color=this.color||"blue",this.innerColor=this.innerColor||"white"},display(){this.fillCircle(this.getGradient(this.innerColor,this.innerRadius))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={applied(){this.radiusX=14,this.radiusY=7,this.judgeRadius=7,this.color=this.color||"blue",this.innerColor=this.innerColor||"white"},display(){this.fillEllipse()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),r=s(3),n=r.bullet8x32p("fog",0,0,208);for(const t in i.color.fallback)n[`fog?color=${t}`]=n[`fog?color=${i.color.fallback[t]}`];e.default={...r.bullet16x16p("scaly",2.4,0,16,"fog",!0,{yOffset:3}),...r.bullet16x16p("ring",4,0,32,"fog"),...r.bullet16x16p("small",4,0,48,"fog"),...r.bullet16x16p("rice",2.4,0,64,"fog",!0),...r.bullet16x16p("chain",2.4,0,80,"fog",!0),...r.bullet16x16p("needle",2.4,0,96,"fog",!0),...r.bullet16x16p("shell",2.8,0,112,"fog",!0),...r.bullet16x16p("bullet",2.4,0,128,"fog",!0),...r.bullet16x16p("bacillus",2.4,0,144,"fog",!0),...r.bullet16x16p("star",4,0,160,"fog",!0),...r.bullet16x16p("explode",4,0,176),...r.bullet16x8p("grape",2.4,0,192),...r.bullet16x8p("grain",2.4,64,192,null,!0),...r.bullet16x8p("point",2.4,0,240),...n}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3);e.default={...i.bullet8x32p("bigstar",7,0,0,"fog",!0),...i.bullet8x32p("medium",8.5,0,32,"fog"),...i.bullet8x32p("butterfly",7,0,64,"fog",!0),...i.bullet8x32p("knife",6,0,96,"fog",!0),...i.bullet8x32p("ellipse",7,0,128,"fog",!0),...i.bullet8x32p("unknown2",7,0,160),...i.bullet4x64p("large",14,0,192)}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3);e.default={...i.bullet8x32p("heart",10,0,0,"fog",!0),...i.bullet8x32p("arrow",4,0,32,"fog",!0,{yOffset:-3}),...i.bullet8x32p("unknown3",4,0,64),...i.bullet8x32p("unknown4",7,0,224),...i.bullet16x16p("drop",2.4,0,192,"fog",!0,{yOffset:-4})}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3);e.default=i.generateTouhouPlugin({hakurei_reimu:i.playerAsset,kochiya_sanae:i.playerAsset,kirisame_marisa:i.playerAsset,tatara_kogasa:{...i.defineEmitterAsset(64,96,{static:[0,0,4],leftward:[0,0,4],rightward:[0,96,4]}),...i.defineEmitterAsset(96,96,{spell:[0,192,2,2,2]})}})},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3);e.default=i.generateTouhouPlugin({hakurei_reimu:i.playerAsset,kochiya_sanae:i.playerAsset,kirisame_marisa:i.playerAsset,reisen_udongein_inaba:i.playerAsset,doremy_sweet:i.defineEmitterAsset(64,96,{static:[0,0,4],leftward:[0,192,6],rightward:[0,96,6],spell:[0,288,6]})})}]);
//# sourceMappingURL=stg.common.js.map