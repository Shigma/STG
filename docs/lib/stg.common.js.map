{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../core/src/config.ts","webpack:///../utils/src/index.ts","webpack:///../core/src/point.ts","webpack:///../core/src/assets.ts","webpack:///../core/src/coordinate.ts","webpack:///../core/src/updater.ts","webpack:///../core/src/index.ts","webpack:///../core/src/barrage.ts","webpack:///../core/src/bullet.ts","webpack:///../core/src/templater.ts","webpack:///../core/src/looping.ts","webpack:///../core/src/player.ts","webpack:///../utils/src/memorize.ts","webpack:///../core/src/field.ts","webpack:///../bullets/src/index.ts","webpack:///./src/library.js","webpack:///../utils/src/random.ts","webpack:///../utils/src/math.ts","webpack:///E:/Obstudio/stg/node_modules/deepmerge/dist/umd.js","webpack:///../bullets/src/fields/distant.ts","webpack:///../bullets/src/fields/timing.ts","webpack:///../bullets/src/fields/viewport.ts","webpack:///../bullets/src/judges/ortho.ts","webpack:///../bullets/src/judges/square.ts","webpack:///../bullets/src/judges/tangent.ts","webpack:///../bullets/src/templates/flaming.ts","webpack:///../bullets/src/templates/large.ts","webpack:///../bullets/src/templates/medium.ts","webpack:///../bullets/src/templates/small.ts","webpack:///../bullets/src/templates/ellipse.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","default","angleUnit","Math","PI","random","__importStar","memorize_1","__importDefault","memorize","math_1","math","utils_1","config_1","coordinate_1","updater_1","[object Object]","options","super","this","_point","x","y","face","show","_displayHook","display","_initHooks","mounted","mutate","assign","methods","state","_coordinate","source","Array","isArray","_mountedHook","forEach","hook","_mutateHook","setTask","$context","$coord","$tick","$birth","rho","theta","cos","sin","args","$parent","$refs","src","emitBullets","fill","color","radius","beginPath","arc","twoPI","closePath","fillStyle","output","stroke","innerColor","radiusX","radiusY","rotation","strokeStyle","lineWidth","ellipse","c1","r1","c2","r2","gradient","createRadialGradient","addColorStop","coords","length","point","resolve","moveTo","point1","point2","point3","bezierCurveTo","quadraticCurveTo","result","assets","images","async","loadImages","requests","fetch","then","response","blob","createImageBitmap","image","catch","push","Promise","all","loadAssets","Coordinate","_face","_cos","_sin","_rho","sqrt","_thetaRadian","thetaRadian","atan2","dx","dy","assets_1","Updater","$assets","$config","tasks","currentTask","tasksToRemove","Set","taskIndex","context","parent","_mounted","updater","__updater__","filter","task","has","id","clear","callback","preserve","add","scheduleLimit","Error","index","Infinity","splice","ticks","removeTask","interval","times","offset","birth","tick","wave","floor","rest","config","barrage_1","Barrage","bullet_1","Bullet","field_1","Field","looping_1","Looping","player_1","Player","point_1","CanvasPoint","templater_1","Templater","__export","_pointCounter","$bullets","_references","reference","keys","setRefPoint","ref","update","bullet","maxBulletCount","render","initialize","start","end","step","emitter","$id","findIndex","layer","template","templates","undefined","judgeType","fieldType","extends","origin","unshift","$origin","install","player","lifeCount","destroy","setTimeout","hookProperties","deepmerge_1","map","noopFunction","__loop__","frameId","frameCount","lastFrame","totalStop","lastStop","recentData","timeLine","lastModifyStats","skipRate","skipFrame","tickLength","tickRate","tickStorage","statsInterval","maxInterpolation","sampleTime","onPause","onResume","onStats","onError","performance","now","cancelAnimationFrame","stopTime","requestAnimationFrame","_render","pause","resume","time","drops","data","Number","frameRate","dropRate","timestamp","loop","round","slice","error","console","currentTime","stats","getStatus","judgeRadius","bombCount","highSpeed","lowSpeed","_listeners","control","canvas","width","height","_mutate","_mouseState","_listen","event","clientX","offsetWidth","clientY","offsetHeight","preventDefault","stopPropagation","_keyState","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Shift","window","target","type","listener","addEventListener","v","getGradient","fillCircle","removeEventListener","CACHE_SIZE","func","base","size","queue","deleteIndex","String","normalize","oldData","newIndex","element","classList","style","background","appendChild","document","createElement","title","getContext","setTitleStyle","titleStyle","fontSize","fontColor","textAlign","textBaseline","fontFamily","removePlayer","barrage","destory","clearScreen","clearRect","showTitle","text","font","fillText","option","showText","distant_1","distant","timing_1","timing","viewport_1","viewport","ortho_1","ortho","square_1","square","tangent_1","tangent","flaming_1","flaming","large_1","large","medium_1","medium","small_1","small","ellipse_1","__webpack_exports__","_stg_core__WEBPACK_IMPORTED_MODULE_0__","_stg_bullets__WEBPACK_IMPORTED_MODULE_1__","__WEBPACK_IMPORT_KEY__","indexOf","_stg_utils__WEBPACK_IMPORTED_MODULE_2__","_package_json__WEBPACK_IMPORTED_MODULE_3__","pm1","real","choose","weight","total","reduce","prev","curr","int","transfer","init","min","max","cachedMethods","getOwnPropertyNames","includes","isMergeableObject","isNonNullObject","stringValue","toString","$$typeof","REACT_ELEMENT_TYPE","isReactElement","isSpecial","for","cloneUnlessOtherwiseSpecified","clone","deepmerge","val","defaultArrayMerge","concat","arrayMerge","sourceIsArray","targetIsArray","sourceAndTargetTypesMatch","destination","mergeObject","array","next","factory","fieldSize","dist2","lifeSpan","hitPlayer","judgeDist","location","locate","abs","innerR","bdColor","innerRadius","fillEllipse"],"mappings":"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","file":"stg.common.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n","export default {\r\n  angleUnit: Math.PI,\r\n}\r\n","import * as random from './random'\r\nimport memorize from './memorize'\r\nimport math from './math'\r\n\r\nexport {\r\n  random,\r\n  math,\r\n  memorize,\r\n}\r\n","import { math } from '@stg/utils'\r\nimport config from './config'\r\nimport Coordinate, { Point } from './coordinate'\r\nimport Barrage, { BulletEmitter } from './barrage'\r\nimport Updater, { TaskHook, MountHook } from './updater'\r\n\r\ntype MaybeArray<T> = T | T[]\r\ntype MaybeFunction<T> = T | (() => T)\r\n\r\nexport interface PointOptions<T extends CanvasPoint = CanvasPoint> {\r\n  show?: boolean\r\n  state?: MaybeFunction<Record<string, any>>\r\n  mounted?: MaybeArray<MountHook<T & Record<string, any>>>\r\n  mutate?: MaybeArray<TaskHook<T & Record<string, any>>>\r\n  display?: MountHook<T & Record<string, any>>\r\n  methods?: Record<string, (this: T & Record<string, any>, ...args: any[]) => any>\r\n}\r\n\r\n/** a general point in the canvas */\r\nexport default class CanvasPoint extends Updater {\r\n  /** @protected point position */\r\n  protected _point: Point = { x: 0, y: 0, face: 0 }\r\n  /** @protected current coordinate */\r\n  protected _coordinate?: Coordinate\r\n  /** @protected mounted hook */\r\n  protected _mountedHook: MountHook<this>[]\r\n  /** @protected mutate hook */\r\n  protected _mutateHook: TaskHook<this>[]\r\n  /** @protected display hook */\r\n  protected _displayHook: MountHook<this>\r\n\r\n  /** @public the radius of the point */\r\n  public radius?: number\r\n  /** @public the color of the point */\r\n  public color?: any\r\n  /** @public whether the point is shown */\r\n  public show?: boolean\r\n  /** @public parent barrage */\r\n  public $parent: Barrage\r\n\r\n  constructor(options: PointOptions = {}) {\r\n    super()\r\n    this.show = options.show !== false\r\n    this._displayHook = options.display\r\n    this._initHooks('_mountedHook', options.mounted)\r\n    this._initHooks('_mutateHook', options.mutate)\r\n    Object.assign(this, options.methods)\r\n    const state = typeof options.state === 'function'\r\n      ? options.state.call(this)\r\n      : options.state\r\n    Object.assign(this, state)\r\n  }\r\n\r\n  public get x() {\r\n    return this._point.x\r\n  }\r\n\r\n  public get y() {\r\n    return this._point.y\r\n  }\r\n\r\n  public get face() {\r\n    return this._point.face\r\n  }\r\n\r\n  public set x(value) {\r\n    this._point.x = value\r\n    this._coordinate = null\r\n  }\r\n\r\n  public set y(value) {\r\n    this._point.y = value\r\n    this._coordinate = null\r\n  }\r\n\r\n  public set face(value) {\r\n    this._point.face = value\r\n    this._coordinate = null\r\n  }\r\n\r\n  private _initHooks(key: string, source: any) {\r\n    if (Array.isArray(source)) {\r\n      this[key] = source\r\n    } else if (source) {\r\n      this[key] = [source]\r\n    } else {\r\n      this[key] = []\r\n    }\r\n  }\r\n\r\n  _mounted() {\r\n    this._mountedHook.forEach(hook => hook.call(this))\r\n    this._mutateHook.forEach(hook => this.setTask(hook))\r\n  }\r\n\r\n  render() {\r\n    if (!this._displayHook) return\r\n    if (!this.$context || this.show === false) return\r\n    this._displayHook.call(this)\r\n  }\r\n\r\n  get $coord(): Coordinate {\r\n    if (!this._coordinate || this.$tick !== this._coordinate.$birth) {\r\n      this._coordinate = new Coordinate(this.x, this.y, this.face)\r\n      this._coordinate.$birth = this.$tick\r\n    }\r\n    return this._coordinate\r\n  }\r\n\r\n  movePolar(rho = this.rho, theta = this.theta): void {\r\n    this.x += rho * math.cos(config.angleUnit * theta)\r\n    this.y += rho * math.sin(config.angleUnit * theta)\r\n  }\r\n\r\n  /** emit bullets from the barrage */\r\n  emitBullets(end: number, bullet: BulletEmitter): void\r\n  emitBullets(start: number, end: number, bullet: BulletEmitter): void\r\n  emitBullets(start: number, end: number, step: number, bullet: BulletEmitter): void\r\n  emitBullets(...args: [number, any, any?, any?]): void {\r\n    // set temporary source\r\n    this.$parent.$refs.src = this\r\n    this.$parent.emitBullets(...args)\r\n    delete this.$parent.$refs.src\r\n  }\r\n\r\n  fillCircle(fill = this.color, radius = this.radius): void {\r\n    const { x, y } = this.$coord\r\n    this.$context.beginPath()\r\n    this.$context.arc(x, y, radius, 0, math.twoPI)\r\n    this.$context.closePath()\r\n    this.$context.fillStyle = fill.output ? fill.output() : fill\r\n    this.$context.fill()\r\n  }\r\n\r\n  fillEllipse(\r\n    stroke = this.color,\r\n    fill = this.innerColor,\r\n    radiusX = this.radiusX,\r\n    radiusY = this.radiusY,\r\n    rotation = this.face,\r\n  ): void {\r\n    const { x, y } = this.$coord\r\n    this.$context.beginPath()\r\n    this.$context.strokeStyle = stroke\r\n    this.$context.lineWidth = 2\r\n    this.$context.ellipse(x, y, radiusX, radiusY, rotation * config.angleUnit, 0, math.twoPI)\r\n    this.$context.closePath()\r\n    this.$context.stroke()\r\n    this.$context.fillStyle = fill.output ? fill.output() : fill\r\n    this.$context.fill()\r\n  }\r\n\r\n  getGradient(c1: any, r1: number, c2 = this.color, r2 = this.radius): CanvasGradient {\r\n    const { x, y } = this.$coord\r\n    const gradient = this.$context.createRadialGradient(x, y, r1, x, y, r2)\r\n    gradient.addColorStop(0, c1.output ? c1.output() : c1)\r\n    gradient.addColorStop(1, c2.output ? c2.output() : c2)\r\n    return gradient\r\n  }\r\n\r\n  bezierCurve(...coords: number[]) {\r\n    if (coords.length % 6 === 2) {\r\n      const point = this.$coord.resolve(coords[0], coords[1])\r\n      this.$context.moveTo(point.x, point.y)\r\n    }\r\n    for (let i = 0; i < coords.length; i += 6) {\r\n      const point1 = this.$coord.resolve(coords[i], coords[i + 1])\r\n      const point2 = this.$coord.resolve(coords[i + 2], coords[i + 3])\r\n      const point3 = this.$coord.resolve(coords[i + 4], coords[i + 5])\r\n      this.$context.bezierCurveTo(point1.x, point1.y, point2.x, point2.y, point3.x, point3.y)\r\n    }\r\n  }\r\n\r\n  quadraticCurve(...coords: number[]) {\r\n    if (coords.length % 4 === 2) {\r\n      const point = this.$coord.resolve(coords[0], coords[1])\r\n      this.$context.moveTo(point.x, point.y)\r\n    }\r\n    for (let i = 0; i < coords.length; i += 4) {\r\n      const point1 = this.$coord.resolve(coords[i], coords[i + 1])\r\n      const point2 = this.$coord.resolve(coords[i + 2], coords[i + 3])\r\n      this.$context.quadraticCurveTo(point1.x, point1.y, point2.x, point2.y)\r\n    }\r\n  }\r\n\r\n  protected toJSON() {\r\n    const result: Partial<this> = {}\r\n    for (const key in this) {\r\n      if (typeof key === 'string' && key[0] !== '$' && key[0] !== '_' || key === '$tick') {\r\n        result[key] = this[key]\r\n      }\r\n    }\r\n    return result\r\n  }\r\n}\r\n","const assets = {\r\n  images: {},\r\n}\r\n\r\nexport default assets\r\n\r\nexport type ImagesOptions = Record<string, string>\r\nexport type ImagesResolved = Record<string, ImageBitmap>\r\n\r\nexport async function loadImages(source: ImagesOptions = {}) {\r\n  const requests = [] as Promise<ImageBitmap>[]\r\n  for (const key in source) {\r\n    if (!(key in assets.images)) {\r\n      assets.images[key] = fetch(source[key])\r\n        .then(response => response.blob())\r\n        .then(createImageBitmap)\r\n        .then(image => assets.images[key] = image)\r\n        .catch(() => delete assets.images[key])\r\n    }\r\n    requests.push(assets.images[key])\r\n  }\r\n  await Promise.all(requests)\r\n  return assets.images as ImagesResolved\r\n}\r\n\r\nexport interface AssetsOptions {\r\n  images?: Record<string, string>\r\n}\r\n\r\nexport interface AssetsResolved {\r\n  images: ImagesResolved\r\n}\r\n\r\nexport async function loadAssets(options: AssetsOptions = {}) {\r\n  await Promise.all([\r\n    loadImages(options.images),\r\n  ])\r\n  return assets as AssetsResolved\r\n}\r\n","import { math } from '@stg/utils'\r\nimport config from './config'\r\n\r\n/** a general point in Cartesian coordinate system */\r\nexport interface Point {\r\n  /** x coordinate */\r\n  x: number\r\n  /** y coordinate */\r\n  y: number\r\n  /** polar radius */\r\n  rho?: number\r\n  /** polar angle (in the unit of π) */\r\n  theta?: number\r\n  /** point orientation (in the unit of π) */\r\n  face?: number\r\n}\r\n\r\n/** a sub coordinate system in Cartesian coordinate system */\r\nexport default class Coordinate implements Point {\r\n  public x: number\r\n  public y: number\r\n  public $birth?: number\r\n\r\n  private _cos: number\r\n  private _sin: number\r\n  private _rho: number\r\n  private _face: number\r\n  private _thetaRadian: number\r\n  \r\n  constructor(x: number, y: number, face?: number) {\r\n    this.x = x\r\n    this.y = y\r\n    this.face = face\r\n  }\r\n\r\n  get face(): number {\r\n    return this._face\r\n  }\r\n\r\n  set face(value) {\r\n    this._face = value || 0\r\n    this._cos = math.cos(config.angleUnit * value || 0)\r\n    this._sin = math.sin(config.angleUnit * value || 0)\r\n  }\r\n\r\n  get rho(): number {\r\n    if (this._rho) return this._rho\r\n    return this._rho = math.sqrt(this.x ** 2 + this.y ** 2)\r\n  }\r\n\r\n  get theta(): number {\r\n    return this._thetaRadian / config.angleUnit\r\n  }\r\n\r\n  get thetaRadian() {\r\n    if (typeof this._thetaRadian === 'number') return this._thetaRadian\r\n    return this._thetaRadian = math.atan2(this.y, this.x)\r\n  }\r\n\r\n  dist2(point: Point): number {\r\n    return (this.x - point.x) ** 2 + (this.y - point.y) ** 2\r\n  }\r\n\r\n  resolve(coordinate: Coordinate): Coordinate\r\n  resolve(x: number, y: number, face?: number): Coordinate\r\n  resolve(...args: [any, any?, any?]) {\r\n    let x: number, y: number, face: number\r\n    if (typeof args[0] === 'object') {\r\n      x = args[0].x\r\n      y = args[0].y\r\n      face = args[0].face\r\n    } else {\r\n      [x, y, face = 0] = args\r\n    }\r\n    return new Coordinate(\r\n      this.x + x * this._cos - y * this._sin,\r\n      this.y + x * this._sin + y * this._cos,\r\n      this.face + face,\r\n    )\r\n  }\r\n\r\n  locate(coordinate: Coordinate): Coordinate\r\n  locate(x: number, y: number, face?: number): Coordinate\r\n  locate(...args: [any, any?, any?]) {\r\n    let x: number, y: number, face: number\r\n    if (typeof args[0] === 'object') {\r\n      x = args[0].x\r\n      y = args[0].y\r\n      face = args[0].face\r\n    } else {\r\n      [x, y, face = 0] = args\r\n    }\r\n    const dx = x - this.x, dy = y - this.y\r\n    return new Coordinate(\r\n      dx * this._cos + dy * this._sin,\r\n      dy * this._cos - dx * this._sin,\r\n      face - this.face,\r\n    )\r\n  }\r\n}\r\n","import assets from './assets'\r\nimport config from './config'\r\n\r\n/** hook function for interval tasks of an updater */\r\nexport type IntervalHook<T extends Updater> = (this: T, tick: number, wave: number) => void\r\n/** hook function for general tasks of an updater */\r\nexport type TaskHook<T extends Updater> = (this: T, tick: number) => void\r\n/** hook function for mounting tasks of an updater */\r\nexport type MountHook<T extends Updater> = (this: T) => void\r\n\r\ninterface UpdaterProperties {\r\n  /** store all scheduled hooks */\r\n  tasks: {\r\n    callback: TaskHook<Updater>\r\n    preserve: boolean\r\n    id: number\r\n  }[]\r\n  /** current task index */\r\n  currentTask: number\r\n  /** a list for tasks to remove */\r\n  tasksToRemove: Set<number>\r\n  /** store the last task index */\r\n  taskIndex: 0\r\n}\r\n\r\n/** general updating object */\r\nexport default class Updater {\r\n  /** @static maximum number of scheduled tasks */\r\n  static scheduleLimit = 256\r\n\r\n  /** @private updater properties */\r\n  private __updater__: UpdaterProperties\r\n  /** @private mounted hook */\r\n  public _mounted?(): void\r\n\r\n  /** @public public assets */\r\n  public readonly $assets = assets\r\n  /** @public global configurations */\r\n  public readonly $config = config\r\n  /** @public rendering context */\r\n  public $context: CanvasRenderingContext2D\r\n  /** @public the current tick number */\r\n  public $tick = 0\r\n  /** @public parrent node */\r\n  public $parent: Updater\r\n\r\n  // inherit from state, methods and so on\r\n  [K: string]: any\r\n\r\n  constructor() {\r\n    Object.defineProperty(this, '__updater__', {\r\n      value: {\r\n        tasks: [],\r\n        currentTask: null,\r\n        tasksToRemove: new Set<number>(),\r\n        taskIndex: 0,\r\n      }\r\n    })\r\n  }\r\n\r\n  /** initialize */\r\n  initialize(context?: CanvasRenderingContext2D, parent?: Updater): this {\r\n    this.$context = context\r\n    this.$parent = parent\r\n    if (this._mounted) this._mounted()\r\n    return this\r\n  }\r\n\r\n  /** perform an update cycle */\r\n  update(): void {\r\n    // update tick number\r\n    this.$tick += 1\r\n    const updater = this.__updater__\r\n\r\n    // remove all the finished tasks\r\n    updater.tasks = updater.tasks.filter(task => {\r\n      return !updater.tasksToRemove.has(task.id)\r\n    })\r\n    \r\n    // store all the tasks to prevent modification from task callbacks\r\n    const tasks = updater.tasks\r\n\r\n    // clear the set of tasks to remove\r\n    updater.tasksToRemove.clear()\r\n\r\n    // execute all the tasks in sequence\r\n    tasks.forEach((hook) => {\r\n      updater.currentTask = hook.id\r\n      hook.callback.call(this, this.$tick)\r\n      if (!hook.preserve) {\r\n        // if not preserved, remove the task after executed\r\n        updater.tasksToRemove.add(hook.id)\r\n      }\r\n    })\r\n\r\n    // check the amount of scheduled tasks for performance\r\n    if (updater.tasks.length > Updater.scheduleLimit) {\r\n      throw new Error(`The amount of scheduled tasks (${updater.tasks.length}) is beyond the limit!`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * set a scheduled task\r\n   * @param callback the task callback\r\n   * @param index the position where the task will be inserted (default: `Infinity`)\r\n   * @param preserve whether the task will be preserved after executed (default: `true`)\r\n   * @returns a number which indicates the task id\r\n   */\r\n  setTask(callback: TaskHook<this>, index = Infinity, preserve = true) {\r\n    const id = ++ this.__updater__.taskIndex\r\n    this.__updater__.tasks.splice(index, 0, { callback, preserve, id })\r\n    return id\r\n  }\r\n\r\n  /**\r\n   * set a timeout task\r\n   * @param ticks the ticks to wait before the callback\r\n   * @param callback the task callback\r\n   * @returns a number which indicates the task id\r\n   */\r\n  setTimeout(ticks: number, callback: TaskHook<this>) {\r\n    ticks += this.$tick\r\n    return this.setTask(() => {\r\n      if (this.$tick <= ticks) return\r\n      callback.call(this, this.$tick)\r\n      this.removeTask()\r\n    }, 0)\r\n  }\r\n\r\n  /**\r\n   * set an interval task\r\n   * @param interval the ticks to wait during every interval\r\n   * @param times the total times for callback to execute (default: `Infinity`)\r\n   * @param offset the offset ticks before the first interval (default: `0`)\r\n   * @param callback the task callback\r\n   * @returns a number which indicates the task id\r\n   */\r\n  setInterval(interval: number, callback: IntervalHook<this>): number\r\n  setInterval(interval: number, times: number, callback: IntervalHook<this>): number\r\n  setInterval(interval: number, times: number, offset: number, callback: IntervalHook<this>): number\r\n  setInterval(interval: number, ...args: [any, any?, any?]) {\r\n    if (interval <= 0) throw new Error(`The interval ${interval} should be positive.`)\r\n    const times: number = args.length > 1 ? args[0] : Infinity\r\n    const offset: number = args.length > 2 ? args[1] : 0\r\n    const callback: IntervalHook<this> = args[args.length - 1]\r\n    const birth = this.$tick + offset\r\n    return this.setTask((tick) => {\r\n      tick -= birth\r\n      const wave = Math.floor(tick / interval)\r\n      const rest = wave * interval - tick\r\n      if (wave > 0 && rest >= 0 && rest < interval) {\r\n        callback.call(this, this.$tick)\r\n        if (wave >= times) return this.removeTask()\r\n      }\r\n    }, 0)\r\n  }\r\n\r\n  /**\r\n   * remove a scheduled task\r\n   * @param id task id (default: current task id)\r\n   */\r\n  removeTask(id = this.__updater__.currentTask) {\r\n    if (!id) return\r\n    this.__updater__.tasksToRemove.add(id)\r\n  }\r\n}\r\n","import assets from './assets'\r\nimport config from './config'\r\nimport Barrage from './barrage'\r\nimport Bullet from './bullet'\r\nimport Coordinate from './coordinate'\r\nimport Field from './field'\r\nimport Looping from './looping'\r\nimport Player from './player'\r\nimport CanvasPoint from './point'\r\nimport Templater from './templater'\r\nimport Updater from './updater'\r\n\r\nexport * from './assets'\r\nexport * from './barrage'\r\nexport * from './bullet'\r\nexport * from './coordinate'\r\nexport * from './field'\r\nexport * from './looping'\r\nexport * from './player'\r\nexport * from './point'\r\nexport * from './templater'\r\nexport * from './updater'\r\n\r\nexport {\r\n  assets,\r\n  config,\r\n  Barrage,\r\n  Bullet,\r\n  CanvasPoint,\r\n  Coordinate,\r\n  Field,\r\n  Looping,\r\n  Player,\r\n  Templater,\r\n  Updater,\r\n}\r\n","import Player from './player'\r\nimport { AssetsOptions } from './assets'\r\nimport Bullet, { BulletOptions } from './bullet'\r\nimport CanvasPoint, { PointOptions } from './point'\r\nimport Updater, { MountHook, TaskHook } from './updater'\r\n\r\ntype MaybeFunction<T> = T | (() => T)\r\n\r\nexport interface BarrageOptions<T extends Barrage = Barrage> {\r\n  assets?: AssetsOptions\r\n  state?: MaybeFunction<Record<string, any>>\r\n  reference?: Record<string, CanvasPoint | PointOptions>\r\n  mounted?: MountHook<T & Record<string, any>>\r\n  mutate?: TaskHook<T & Record<string, any>>\r\n  methods?: Record<string, (this: T & Record<string, any>, ...args: any[]) => any>\r\n}\r\n\r\nexport type BulletEmitter = ((this: Barrage, index: number) => BulletOptions) | BulletOptions\r\n\r\nexport interface BarrageReferences extends Record<string, CanvasPoint> {\r\n  player?: Player\r\n  src?: CanvasPoint\r\n  base?: CanvasPoint\r\n}\r\n\r\nexport default class Barrage extends Updater {\r\n  /** @static max bullet count */\r\n  static maxBulletCount = 4096\r\n\r\n  /** @private store the last created point index */\r\n  private _pointCounter = 0\r\n  /** @protected mounted hook */\r\n  protected _mountedHook: MountHook<this & any>\r\n  /** @protected mutate hook */\r\n  protected _mutateHook: TaskHook<this & any>\r\n  /** @protected reference points */\r\n  protected _references: Record<string, CanvasPoint | PointOptions>\r\n\r\n  /** @public bullets in the barrage */\r\n  public $bullets: Bullet[]\r\n  /** @public reference coordinates */\r\n  public $refs: BarrageReferences\r\n\r\n  constructor(options: BarrageOptions = {}) {\r\n    super()\r\n    this.$refs = {}\r\n    this.$bullets = []\r\n    this._mutateHook = options.mutate\r\n    this._mountedHook = options.mounted\r\n    this._references = options.reference || {}\r\n    Object.assign(this, options.methods)\r\n    const state = typeof options.state === 'function'\r\n      ? options.state.call(this)\r\n      : options.state\r\n    Object.assign(this, state)\r\n  }\r\n\r\n  _mounted() {\r\n    this.$refs = {}\r\n    if (this._mountedHook) this._mountedHook()\r\n    if (this._mutateHook) this.setTask(this._mutateHook)\r\n    for (const key of Object.keys(this._references)) {\r\n      this.setRefPoint(key, this._references[key])\r\n    }\r\n    this.setTask(() => {\r\n      for (const key in this.$refs) {\r\n        const ref = this.$refs[key]\r\n        if (ref.$parent === this) ref.update()\r\n      }\r\n      this.$bullets.forEach(bullet => bullet.update())\r\n      if (this.$bullets.length > Barrage.maxBulletCount) {\r\n        throw new Error(`The amount of bullets ${this.$bullets.length} is beyond the limit!`)\r\n      }\r\n    })\r\n  }\r\n\r\n  render() {\r\n    for (const key in this.$refs) {\r\n      const ref = this.$refs[key]\r\n      if (ref.$parent === this) ref.render()\r\n    }\r\n    this.$bullets.forEach(bullet => bullet.render())\r\n  }\r\n\r\n  /**\r\n   * set a reference point\r\n   * @returns reference key\r\n   */\r\n  setRefPoint(reference: PointOptions): number\r\n  setRefPoint(key: string, reference: PointOptions): string\r\n  setRefPoint(...args: any[]): number | string {\r\n    const options: PointOptions = args[args.length - 1]\r\n    const key = args.length > 1 ? args[0] : ++ this._pointCounter\r\n    this.$refs[key] = new CanvasPoint(options).initialize(this.$context, this)\r\n    return key\r\n  }\r\n\r\n  /**\r\n   * remove a reference point\r\n   * @returns whether the provided key is found\r\n   */\r\n  removeRefPoint(key: string | number): boolean {\r\n    return delete this.$refs[key]\r\n  }\r\n\r\n  /** emit bullets from the barrage */\r\n  emitBullets(end: number, bullet: BulletEmitter): void\r\n  emitBullets(start: number, end: number, bullet: BulletEmitter): void\r\n  emitBullets(start: number, end: number, step: number, bullet: BulletEmitter): void\r\n  emitBullets(...args: [number, any, any?, any?]): void {\r\n    const start: number = args.length > 2 ? args[0] : 0\r\n    const end: number = args.length > 1 ? args.length > 2 ? args[1] : args[0] : 1\r\n    const step: number = args.length > 3 ? args[2] : 1\r\n    const emitter: BulletEmitter = args[args.length - 1]\r\n    for (let i = start; i < end; i += step) {\r\n      const options = typeof emitter === 'function' ? emitter.call(this, i) : emitter\r\n      const bullet = new Bullet(options)\r\n      bullet.$id = ++ this._pointCounter\r\n      for (const key in this.$refs) {\r\n        bullet.$refs[key] = this.$refs[key].$coord\r\n      }\r\n      bullet.initialize(this.$context, this)\r\n      const index = this.$bullets.findIndex(({ layer }) => layer > bullet.layer)\r\n      if (index < 0) {\r\n        this.$bullets.push(bullet)\r\n      } else {\r\n        this.$bullets.splice(index, 0, bullet)\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { math } from '@stg/utils'\r\nimport config from './config'\r\nimport Templater, { Extension } from './templater'\r\nimport Coordinate, { Point } from './coordinate'\r\nimport CanvasPoint, { PointOptions } from './point'\r\n\r\ntype JudgeType = 'square' | 'ortho' | 'tangent' | 'none'\r\ntype FieldType = 'viewport' | 'distant' | 'timing' | 'infinite'\r\n\r\ninterface BulletPoint {\r\n  /** judge type (default: `ortho`) */\r\n  judgeType?: JudgeType\r\n  /** field type (default: `viewport`) */\r\n  fieldType?: FieldType\r\n  /** relative point */\r\n  origin?: string | Point\r\n  /** display layer */\r\n  layer?: number\r\n}\r\n\r\nexport interface BulletOptions extends PointOptions<Bullet>, BulletPoint {\r\n  extends?: Extension<BulletOptions>\r\n}\r\n\r\nexport interface BulletReferences {\r\n  [key: string]: Coordinate\r\n  player?: Coordinate\r\n  base?: Coordinate\r\n  src?: Coordinate\r\n}\r\n\r\nexport default class Bullet extends CanvasPoint implements BulletPoint {\r\n  /** built-in templates */\r\n  static templates = new Templater<BulletOptions>({\r\n    hookProperties: ['mutate', 'mounted'],\r\n  })\r\n\r\n  /** install new bullet templates */\r\n  static install(templates: Record<string, BulletOptions>): void\r\n  static install(name: string, options: BulletOptions): void\r\n  static install(...args: [any, any?]) {\r\n    this.templates.install(...args)\r\n  }\r\n\r\n  public layer: number\r\n  public judgeType: JudgeType\r\n  public fieldType: FieldType\r\n\r\n  /** @public judge radius */\r\n  public judgeRadius?: number\r\n  /** @public buller id */\r\n  public $id: number\r\n  /** @public reference points */\r\n  public $refs: BulletReferences\r\n  /** @public origin point */\r\n  public $origin: Point\r\n\r\n  constructor(options: BulletOptions = {}) {\r\n    const template = Bullet.templates.resolve(options)\r\n    if (template.judgeType === undefined) {\r\n      template.judgeType = 'ortho'\r\n    } else if (template.judgeType === 'none') {\r\n      template.judgeType = null\r\n    }\r\n    if (template.fieldType === undefined) {\r\n      template.fieldType = 'viewport'\r\n    } else if (template.fieldType === 'infinite') {\r\n      template.fieldType = null\r\n    }\r\n    template.extends = [template.fieldType, template.judgeType]\r\n    super(Bullet.templates.resolve(template))\r\n    this.$refs = {}\r\n    this.layer = template.layer === undefined ? 0 : template.layer\r\n    const origin = template.origin === undefined ? 'origin' : template.origin\r\n    this._mountedHook.unshift(() => {\r\n      this.$origin = typeof origin === 'string'\r\n        ? this.$refs[origin] || { x: 0, y: 0, face: 0 }\r\n        : origin\r\n    })\r\n  }\r\n\r\n  get $coord(): Coordinate {\r\n    if (!this._coordinate || this.$tick !== this._coordinate.$birth) {\r\n      this._coordinate = new Coordinate(\r\n        this.x + this.$origin.x,\r\n        this.y + this.$origin.y,\r\n        this.face + this.$origin.face,\r\n      )\r\n      this._coordinate.$birth = this.$tick\r\n    }\r\n    return this._coordinate\r\n  }\r\n\r\n  polarLocate(rho = this.rho, theta = this.theta) {\r\n    theta += this.$origin.face\r\n    this.x = rho * math.cos(config.angleUnit * theta)\r\n    this.y = rho * math.sin(config.angleUnit * theta)\r\n  }\r\n\r\n  hitPlayer() {\r\n    this.$parent.$refs.player.lifeCount -= 1\r\n    this.destroy()\r\n  }\r\n\r\n  destroy() {\r\n    const $id = this.$id\r\n    this.$parent.setTimeout(0, function() {\r\n      const index = this.$bullets.findIndex(bullet => bullet.$id === $id)\r\n      if (index >= 0) this.$bullets.splice(index, 1)\r\n    })\r\n  }\r\n}\r\n","import deepmerge from 'deepmerge'\r\n\r\nexport type Extension<T extends Extensible<T>> = string | string[] | T | T[]\r\n\r\nexport interface Extensible<T> extends Record<string, any> {\r\n\textends?: Extension<T>\r\n}\r\n\r\nexport interface MergeOptions {\r\n\thookProperties?: string[]\r\n}\r\n\r\nexport default class Templater<T extends Extensible<T>> {\r\n\tprivate templates: Record<string, T> = {}\r\n\tprivate options: MergeOptions = {}\r\n\r\n\tconstructor(options: MergeOptions = {}) {\r\n\t\tObject.assign(this.options, options)\r\n\t}\r\n\r\n\tinstall(templates: Record<string, T>): void\r\n  install(name: string, options: T): void\r\n  install(...args: any) {\r\n    if (typeof args[0] === 'string') {\r\n      this.templates[args[0]] = args[1]\r\n    } else if (typeof args[0] === 'object') {\r\n      Object.assign(this.templates, args[0])\r\n    }\r\n\t}\r\n\t\r\n\tresolve(template: Extension<T>): T {\r\n    if (Array.isArray(template)) {\r\n      return deepmerge.all<T>((<any>template).map((t: string | T) => this.resolve(t)))\r\n    } else if (typeof template === 'string') {\r\n      if (template in this.templates) {\r\n        return this.resolve(this.templates[template])\r\n      } else {\r\n        throw new Error(`Template ${template} was not registered.`)\r\n      }\r\n    } else {\r\n\t\t\tif (template.extends) {\r\n\t\t\t\ttemplate = deepmerge<T>(this.resolve(template.extends), template)\r\n\t\t\t\tdelete template.extends\r\n\t\t\t}\r\n\t\t\tfor (const key of this.options.hookProperties) {\r\n\t\t\t\tif (template[key] !== undefined && !Array.isArray(template[key])) {\r\n\t\t\t\t\ttemplate[key] = [template[key]]\r\n\t\t\t\t}\r\n\t\t\t}\r\n      return template\r\n    }\r\n  }\r\n}\r\n","interface LoopingEvents {\r\n  onPause?(this: Looping): void\r\n  onResume?(this: Looping): void\r\n  onStats?(this: Looping, stats?: LoopingStats): void\r\n  onError?(this: Looping, error?: Error): void\r\n}\r\n\r\ninterface LoopingConfig {\r\n  /** amount of ticks used to calculate the frame rate */\r\n  tickStorage?: number\r\n  /** maximum tick interpolation at one frame */\r\n  maxInterpolation?: number\r\n  /** interval for event `stats` to trigger */\r\n  statsInterval?: number\r\n}\r\n\r\nexport interface LoopingOptions extends LoopingEvents, LoopingConfig {\r\n  /** minimun length of a tick */\r\n  tickRate?: number\r\n  /** number of skipped frames after rendering */\r\n  skipFrame?: number\r\n}\r\n\r\nexport interface LoopingStats {\r\n  /** average number of ticks in a second */\r\n  tickRate: number\r\n  /** average number of frames in a second */\r\n  frameRate: number\r\n  /** the proportion of dropped frames */\r\n  dropRate: number\r\n}\r\n\r\ninterface LoopingProperties extends LoopingConfig {\r\n  options: LoopingOptions\r\n  /** current frame id */\r\n  frameId: number\r\n  /** frame count */\r\n  frameCount: number\r\n  /** the time when last tick started */\r\n  lastFrame: number\r\n  /** total stop time */\r\n  totalStop: number\r\n  /** last stop time */\r\n  lastStop: number\r\n  /** recent tick lengths */\r\n  recentData: {\r\n    ticks: number,\r\n    time: number,\r\n  }[]\r\n  /** total updating time */\r\n  timeLine: number\r\n  /** total updating time */\r\n  tickLength: number\r\n  /** reciprocal of proportion of skipped frames */\r\n  skipRate: number\r\n  /** preservation time for samples */\r\n  sampleTime: number\r\n  /** time for last modifying stats */\r\n  lastModifyStats: number\r\n}\r\n\r\nfunction noopFunction() {}\r\n\r\nexport default class Looping implements LoopingEvents {\r\n  /** @private looping properties */\r\n  private __loop__: LoopingProperties\r\n\r\n  // looping hooks\r\n  public update?(): void\r\n  public render?(): void\r\n  public onPause?(this: Looping): void\r\n  public onResume?(this: Looping): void\r\n  public onStats?(this: Looping, stats?: LoopingStats): void\r\n  public onError?(this: Looping, error?: Error): void\r\n\r\n  constructor(options: LoopingOptions = {}) {\r\n    this.initialize(options)\r\n  }\r\n\r\n  /** initialize */\r\n  public initialize(options: LoopingOptions = {}) {\r\n    // use old options as fallback\r\n    if ('__loop__' in this) {\r\n      options = Object.assign(this.__loop__.options, options)\r\n    }\r\n    // initiate `__loop__` properties\r\n    const value = {\r\n      options,\r\n      frameId: null,\r\n      frameCount: 0,\r\n      lastFrame: null,\r\n      totalStop: 0,\r\n      lastStop: null,\r\n      recentData: [],\r\n      timeLine: null,\r\n      lastModifyStats: 0,\r\n      skipRate: 1 + (options.skipFrame || 0),\r\n      tickLength: 1000 / (options.tickRate || 60),\r\n      tickStorage: options.tickStorage || 60,\r\n      statsInterval: options.statsInterval || Infinity,\r\n      maxInterpolation: options.maxInterpolation || 5,\r\n    } as LoopingProperties\r\n    value.sampleTime = value.tickLength * value.tickStorage\r\n    Object.defineProperty(this, '__loop__', { value })\r\n    // set event hooks\r\n    this.onPause = options.onPause || noopFunction\r\n    this.onResume = options.onResume || noopFunction\r\n    this.onStats = options.onStats || noopFunction\r\n    this.onError = options.onError || noopFunction\r\n    return this\r\n  }\r\n\r\n  /** pause */\r\n  public pause() {\r\n    if (!this.__loop__.frameId) return\r\n    this.__loop__.lastStop = performance.now()\r\n    cancelAnimationFrame(this.__loop__.frameId)\r\n    this.__loop__.frameId = null\r\n    this.onPause()\r\n  }\r\n\r\n  /** resume */\r\n  public resume() {\r\n    if (this.__loop__.frameId) return\r\n    if (this.__loop__.lastStop) {\r\n      const stopTime = performance.now() - this.__loop__.lastStop\r\n      this.__loop__.totalStop += stopTime\r\n      if (this.__loop__.lastFrame) this.__loop__.lastFrame += stopTime\r\n    }\r\n    this.__loop__.frameId = requestAnimationFrame(t => this._render(t))\r\n    this.onResume()\r\n  }\r\n\r\n  /** change status between pause and resume */\r\n  public toggle() {\r\n    if (this.__loop__.frameId !== null) {\r\n      this.pause()\r\n    } else {\r\n      this.resume()\r\n    }\r\n  }\r\n\r\n  /** get current status */\r\n  public getStatus(): LoopingStats {\r\n    const { recentData } = this.__loop__\r\n    if (!recentData.length) return null\r\n    let time = 0, ticks = 0, drops = 0\r\n    for (const data of recentData) {\r\n      time += data.time\r\n      ticks += data.ticks\r\n      drops += Number(data.ticks !== 1)\r\n    }\r\n    return {\r\n      tickRate: 1000 / time * ticks,\r\n      frameRate: 1000 / time * recentData.length,\r\n      dropRate: drops / recentData.length,\r\n    }\r\n  }\r\n\r\n  private _render(timestamp: number) {\r\n    const loop = this.__loop__\r\n\r\n    // calculate tick numbers\r\n    const lifeTime = timestamp - loop.totalStop\r\n    let ticks = (lifeTime - loop.timeLine) / loop.tickLength\r\n    if (ticks < 1) {\r\n      ticks = Math.round(ticks)\r\n    } else {\r\n      ticks = Math.floor(ticks)\r\n    }\r\n    if (ticks > loop.maxInterpolation) {\r\n      ticks = loop.maxInterpolation\r\n      loop.timeLine = timestamp - loop.totalStop\r\n    } else {\r\n      loop.timeLine += ticks * loop.tickLength\r\n    }\r\n\r\n    // record current frame data\r\n    const time = timestamp - (loop.lastFrame || 0)\r\n    if (loop.lastFrame) {\r\n      loop.recentData.unshift({ time, ticks })\r\n      loop.recentData = loop.recentData.slice(0, loop.tickStorage)\r\n    }\r\n    loop.lastFrame = timestamp\r\n\r\n    // perform the current frame\r\n    try {\r\n      for (let index = 0; index < ticks; index += 1) {\r\n        this.update()\r\n      }\r\n      if (ticks) {\r\n        if (loop.frameCount % loop.skipRate === 0) {\r\n          this.render()\r\n        }\r\n        loop.frameCount += 1\r\n      }\r\n    } catch (error) {\r\n      console.error(error)\r\n      this.onError(error)\r\n      this.pause()\r\n      return\r\n    }\r\n\r\n    // request the next frame\r\n    loop.frameId = requestAnimationFrame(t => this._render(t))\r\n    \r\n    // check if stats need to update\r\n    const currentTime = performance.now()\r\n    if (currentTime - loop.lastModifyStats < loop.statsInterval) return\r\n    loop.lastModifyStats = currentTime\r\n    const stats = this.getStatus()\r\n    if (stats) this.onStats(stats)\r\n  }\r\n}\r\n","import { TaskHook, MountHook } from './updater'\r\nimport { AssetsOptions } from './assets'\r\nimport { Point } from './coordinate'\r\nimport CanvasPoint from './point'\r\n\r\ntype BoolInt = 0 | 1\r\ntype ControlMode = 'keyboard' | 'mouse'\r\ntype Listener = [\r\n  EventTarget,\r\n  string,\r\n  (this: Player, event: Event) => any,\r\n  boolean | AddEventListenerOptions\r\n]\r\n\r\ninterface KeyState extends Record<string, BoolInt> {\r\n  ArrowUp: BoolInt\r\n  ArrowDown: BoolInt\r\n  ArrowLeft: BoolInt\r\n  ArrowRight: BoolInt\r\n  Shift: BoolInt\r\n}\r\n\r\nexport interface PlayerOptions {\r\n  assets?: AssetsOptions\r\n  control?: ControlMode\r\n  state?: PlayerState\r\n  mounted?: MountHook<Player>\r\n  mutate?: TaskHook<Player>\r\n}\r\n\r\ninterface PlayerState {\r\n  /** judge radius */\r\n  judgeRadius?: number\r\n  /** life count */\r\n  lifeCount?: number\r\n  /** bomb count */\r\n  bombCount?: number\r\n  /** high speed */\r\n  highSpeed?: number\r\n  /** low speed */\r\n  lowSpeed?: number\r\n\r\n  [key: string]: any\r\n}\r\n\r\nexport default class Player extends CanvasPoint implements PlayerState {\r\n  public judgeRadius: number\r\n  public lifeCount: number\r\n  public bombCount: number\r\n  public highSpeed: number\r\n  public lowSpeed: number\r\n\r\n  /** @public the control of the player */\r\n  public readonly control: ControlMode\r\n\r\n  /** @private listeners */\r\n  private _listeners: Listener[]\r\n  /** @private mouse position */\r\n  private _mouseState: Point\r\n  /** @private keyboard state */\r\n  private _keyState: KeyState\r\n\r\n  constructor(options: PlayerOptions = {}) {\r\n    options.state = {\r\n      color: 'red',\r\n      radius: 4,\r\n      lifeCount: 8,\r\n      judgeRadius: 2.5,\r\n      bombCount: 0,\r\n      highSpeed: 5,\r\n      lowSpeed: 2,\r\n      ...options.state,\r\n    }\r\n    super(options)\r\n    this._listeners = []\r\n    this.control = options.control === undefined ? 'keyboard' : options.control\r\n  }\r\n\r\n  _mounted() {\r\n    this.x = this.$context.canvas.width / 2\r\n    this.y = this.$context.canvas.height / 8 * 7\r\n    this._mountedHook.forEach(hook => hook.call(this))\r\n    this.render()\r\n    this.setTask(this._mutate)\r\n\r\n    if (this.control === 'mouse') {\r\n      this._mouseState = { x: 0, y: 0 }\r\n      this._listen(this.$context.canvas, 'mousemove', (event: MouseEvent) => {\r\n        this._mouseState.x = event.clientX / this.$context.canvas.offsetWidth * this.$context.canvas.width\r\n        this._mouseState.y = event.clientY / this.$context.canvas.offsetHeight * this.$context.canvas.height\r\n        event.preventDefault()\r\n        event.stopPropagation()\r\n      })\r\n    } else if (this.control === 'keyboard') {\r\n      this._keyState = {\r\n        ArrowUp: 0,\r\n        ArrowDown: 0,\r\n        ArrowLeft: 0,\r\n        ArrowRight: 0,\r\n        Shift: 0,\r\n      }\r\n      this._listen(window, 'keydown', (event: KeyboardEvent) => {\r\n        if (!(event.key in this._keyState)) return\r\n        this._keyState[event.key] = 1\r\n        event.preventDefault()\r\n        event.stopPropagation()\r\n      })\r\n      this._listen(window, 'keyup', (event: KeyboardEvent) => {\r\n        if (!(event.key in this._keyState)) return\r\n        this._keyState[event.key] = 0\r\n        event.preventDefault()\r\n        event.stopPropagation()\r\n      })\r\n    }\r\n  }\r\n\r\n  private _listen(\r\n    target: EventTarget,\r\n    type: string,\r\n    listener: (event: Event) => any,\r\n    options?: boolean | AddEventListenerOptions,\r\n  ) {\r\n    target.addEventListener(type, listener, options)\r\n    this._listeners.push([target, type, listener, options])\r\n  }\r\n\r\n  private _mutate(tick: number) {\r\n    this._mutateHook.forEach(hook => hook.call(this, tick))\r\n\r\n    if (this.control === 'mouse') {\r\n      this.x = this._mouseState.x\r\n      this.y = this._mouseState.y\r\n    } else if (this.control === 'keyboard') {\r\n      const v = (this._keyState.Shift ? this.lowSpeed : this.highSpeed) / Math.sqrt(\r\n        (this._keyState.ArrowDown ^ this._keyState.ArrowUp) +\r\n        (this._keyState.ArrowLeft ^ this._keyState.ArrowRight) || 1\r\n      )\r\n      this.x += v * this._keyState.ArrowRight\r\n      this.x -= v * this._keyState.ArrowLeft\r\n      this.y += v * this._keyState.ArrowDown\r\n      this.y -= v * this._keyState.ArrowUp\r\n      \r\n      if (this.x < 0) this.x = 0\r\n      if (this.y < 0) this.y = 0\r\n      if (this.x > this.$context.canvas.width) this.x = this.$context.canvas.width\r\n      if (this.y > this.$context.canvas.height) this.y = this.$context.canvas.height\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const gradient = this.getGradient('white', this.radius / 2)\r\n    this.fillCircle(gradient)\r\n  }\r\n\r\n  destory() {\r\n    this._listeners.forEach(([target, type, listener, options]) => {\r\n      target.removeEventListener(type, listener, options)\r\n    })\r\n  }\r\n}\r\n","const CACHE_SIZE = 1024\r\n\r\ninterface CachedData<V> {\r\n  index: number\r\n  value: V\r\n}\r\n\r\n// Normalize function arguments\r\nfunction normalize(args: any[]) {\r\n  let index = args.length - 1\r\n  let id = String(args[index])\r\n  while (--index >= 0) {\r\n    id += '\\u0001' + args[index]\r\n  }\r\n  return id\r\n}\r\n\r\nexport default function memorize<T extends (...args: any[]) => any>(func: T) {\r\n  let base = 1\r\n  let size = 0\r\n  let index = 0\r\n  const queue = {} as Record<number, string>\r\n  const map = {} as Record<string, CachedData<ReturnType<T>>>\r\n\r\n  function deleteIndex(index: number) {\r\n    delete queue[index]\r\n    if (index !== base) return\r\n    while (!queue.hasOwnProperty(++base)) continue\r\n  }\r\n\r\n  return ((...args: any[]) => {\r\n    const id = normalize(args.slice(0, func.length))\r\n    const oldData = map[id]\r\n    const newIndex = ++index\r\n    queue[newIndex] = id\r\n    if (oldData) {\r\n      // Cached data is found\r\n      deleteIndex(oldData.index)\r\n      oldData.index = newIndex\r\n      return oldData.value\r\n    } else {\r\n      // Store uncached data\r\n      const value = func(...args)\r\n      map[id] = { index: newIndex, value }\r\n      size += 1\r\n      if (size <= CACHE_SIZE) return value\r\n\r\n      // Cache overflow, remove least recently used data\r\n      delete map[queue[base]]\r\n      size -= 1\r\n      deleteIndex(base)\r\n      return value\r\n    }\r\n  }) as T\r\n}\r\n","import assets, { loadAssets, AssetsOptions, loadImages, ImagesOptions } from './assets'\r\nimport Looping, { LoopingOptions } from './looping'\r\nimport Barrage, { BarrageOptions } from './barrage'\r\nimport Player, { PlayerOptions } from './player'\r\n\r\nexport interface TextStyle {\r\n  fontSize?: number\r\n  fontColor?: string\r\n  fontFamily?: string\r\n}\r\n\r\nexport interface TextOptions extends TextStyle {\r\n  x?: number\r\n  y?: number\r\n  textAlign?: CanvasTextAlign\r\n  textBaseline?: CanvasTextBaseline\r\n}\r\n\r\nexport interface FieldOptions extends LoopingOptions {\r\n  title?: string\r\n  titleStyle?: TextOptions\r\n  background?: string\r\n  height?: number\r\n  width?: number\r\n}\r\n\r\nexport default class Field extends Looping {\r\n  public readonly context: CanvasRenderingContext2D\r\n  public readonly canvas: HTMLCanvasElement\r\n  public readonly $assets = assets\r\n\r\n  public barrage: Barrage\r\n  public player: Player\r\n  public title: string\r\n  private titleStyle: TextOptions\r\n\r\n  constructor(public readonly element: HTMLElement, options: FieldOptions = {}) {\r\n    super(options)\r\n    element.classList.add('stg-field')\r\n    element.style.background = options.background\r\n    this.canvas = element.appendChild(document.createElement('canvas'))\r\n    this.canvas.height = options.height || 560\r\n    this.canvas.width = options.width || 480\r\n    this.title = options.title || ''\r\n    this.context = this.canvas.getContext('2d')\r\n    this.setTitleStyle(options.titleStyle)\r\n  }\r\n\r\n  setTitleStyle(options: TextStyle = {}) {\r\n    const fontSize = options.fontSize || 24\r\n    this.titleStyle = {\r\n      fontSize,\r\n      fontColor: 'white',\r\n      x: this.canvas.width - fontSize,\r\n      y: fontSize,\r\n      textAlign: 'right',\r\n      textBaseline: 'top',\r\n      fontFamily: 'Calibri, Candara, Segoe, \"Segoe UI\", Optima, Arial',\r\n      ...options,\r\n    }\r\n  }\r\n\r\n  async setPlayer(options: PlayerOptions) {\r\n    if (!options) return\r\n    this.removePlayer()\r\n    await loadAssets(options.assets)\r\n    this.player = new Player(options).initialize(this.context)\r\n    if (this.barrage) this.barrage.$refs.player = this.player\r\n  }\r\n\r\n  removePlayer() {\r\n    if (this.player) this.player.destory()\r\n    if (this.barrage) delete this.barrage.$refs.player\r\n  }\r\n\r\n  async setBarrage(options: BarrageOptions) {\r\n    if (!options) return\r\n    this.pause()\r\n    this.clearScreen()\r\n    await loadAssets(options.assets)\r\n    this.barrage = new Barrage(options).initialize(this.context)\r\n    if (this.player) this.barrage.$refs.player = this.player\r\n  }\r\n\r\n  clearScreen() {\r\n    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height)\r\n  }\r\n\r\n  clear() {\r\n    this.pause()\r\n    this.removePlayer()\r\n    this.clearScreen()\r\n    this.barrage = null\r\n  }\r\n\r\n  update() {\r\n    if (this.barrage) this.barrage.update()\r\n    if (this.player) this.player.update()\r\n  }\r\n\r\n  render() {\r\n    this.clearScreen()\r\n    if (this.barrage) this.barrage.render()\r\n    if (this.player) this.player.render()\r\n    this.showTitle()\r\n  }\r\n\r\n  showText(text: string, options: TextOptions) {\r\n    this.context.textAlign = options.textAlign\r\n    this.context.textBaseline = options.textBaseline\r\n    this.context.fillStyle = options.fontColor\r\n    this.context.font = `${options.fontSize || 16}px ${options.fontFamily}`\r\n    this.context.fillText(text, options.x, options.y)\r\n  }\r\n\r\n  private showTitle() {\r\n    const option = this.title && this.titleStyle\r\n    if (!option) return\r\n    this.showText(this.title, option)\r\n  }\r\n\r\n  loadAssets(options?: AssetsOptions) {\r\n    return loadAssets(options)\r\n  }\r\n\r\n  loadImages(options?: ImagesOptions) {\r\n    return loadImages(options)\r\n  }\r\n}\r\n","import distant from './fields/distant'\r\nimport timing from './fields/timing'\r\nimport viewport from './fields/viewport'\r\n\r\nimport ortho from './judges/ortho'\r\nimport square from './judges/square'\r\nimport tangent from './judges/tangent'\r\n\r\nimport flaming from './templates/flaming'\r\nimport large from './templates/large'\r\nimport medium from './templates/medium'\r\nimport small from './templates/small'\r\nimport ellipse from './templates/ellipse'\r\n\r\nexport {\r\n  distant,\r\n  timing,\r\n  viewport,\r\n  ortho,\r\n  square,\r\n  tangent,\r\n  flaming,\r\n  large,\r\n  medium,\r\n  small,\r\n  ellipse,\r\n}\r\n","import { Bullet } from '@stg/core'\r\nimport * as builtin from '@stg/bullets'\r\n\r\nBullet.install(builtin)\r\n\r\nexport * from '@stg/core'\r\nexport * from '@stg/utils'\r\nexport { version } from '../package.json'\r\n","/** ±1 (plus minus one) */\r\nexport function pm1() {\r\n  return Math.floor(Math.random() * 2) * 2 - 1 as 1 | -1\r\n}\r\n\r\n/**\r\n * random real\r\n * @param start start number\r\n * @param end end number\r\n * @returns a random real in the interval [start, end)\r\n */\r\nexport function real(end: number): number\r\nexport function real(start: number, end: number): number\r\nexport function real(...args: [number, number?]): number {\r\n  const start = args.length > 1 ? args[0] : 0\r\n  const end = args[args.length - 1]\r\n  return Math.random() * (end - start) + start\r\n}\r\n\r\n/**\r\n * random integer\r\n * @param start start number\r\n * @param end end number\r\n * @returns a random integer in the interval [start, end)\r\n */\r\nexport function int(end: number): number\r\nexport function int(start: number, end: number): number\r\nexport function int(...args: [number, number?]): number {\r\n  return Math.floor(real(...args))\r\n}\r\n\r\n/**\r\n * get random index by chance\r\n * @param weight weight for every index\r\n * @returns the selected index\r\n */\r\nexport function choose(...weight: number[]) {\r\n  let total = Math.random() * weight.reduce((prev, curr) => prev + curr, 0)\r\n  for (let index = 0; index < weight.length; index += 1) {\r\n    total -= weight[index]\r\n    if (total < 0) return index\r\n  }\r\n}\r\n\r\n/**\r\n * random transfer\r\n * @param init initial position\r\n * @param start start number\r\n * @param end end number\r\n * @param min minimum transfer distance\r\n * @param max maximum transfer distance\r\n */\r\nexport function transfer(init: number, start: number, end: number, min: number, max: number): number {\r\n  return init < start + min\r\n    ? init + real(min, max)\r\n    : init > end - min\r\n    ? init - real(min, max)\r\n    : init < start + max\r\n    ? choose(init - start - min, max - min)\r\n      ? init + real(min, max)\r\n      : init - real(min, init - start - min)\r\n    : init > end - max\r\n    ? choose(end - init - min, max - min)\r\n      ? init - real(min, max)\r\n      : init + real(min, end - init - min)\r\n    : init + real(min, max) * pm1()\r\n}\r\n","import memorize from './memorize'\r\n\r\ntype MathExtension = typeof Math & {\r\n  twoPI: number\r\n  halfPI: number\r\n}\r\n\r\nconst math = {} as MathExtension\r\nconst cachedMethods = [\r\n  'sqrt', 'cbrt', 'exp',\r\n  'log', 'log2', 'log10',\r\n  'sin', 'cos', 'tan',\r\n  'asin', 'acos', 'atan',\r\n  'sinh', 'cosh', 'tanh',\r\n  'asinh', 'acosh', 'atanh',\r\n]\r\n\r\nObject.defineProperty(math, 'twoPI', { value: Math.PI * 2 })\r\nObject.defineProperty(math, 'halfPI', { value: Math.PI / 2 })\r\n\r\nObject.getOwnPropertyNames(Math).forEach((key) => {\r\n  Object.defineProperty(math, key, {\r\n    value: cachedMethods.includes(key)\r\n      ? memorize(Math[key])\r\n      : Math[key]\r\n  })\r\n})\r\n\r\nexport default math\r\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.deepmerge = factory());\n}(this, (function () { 'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tObject.keys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tObject.keys(source).forEach(function(key) {\n\t\tif (!options.isMergeableObject(source[key]) || !target[key]) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = deepmerge(target[key], source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nreturn deepmerge_1;\n\n})));\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  state: {\r\n    fieldSize: 1e3,\r\n  },\r\n  mutate() {\r\n    if (this.$refs.src.dist2(this.$coord) > this.fieldSize ** 2) {\r\n      this.destroy()\r\n    }\r\n  },\r\n} as BulletOptions\r\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  state: {\r\n    lifeSpan: 12000,\r\n  },\r\n  mutate(tick) {\r\n    if (tick > this.lifeSpan) {\r\n      this.destroy()\r\n    }\r\n  },\r\n} as BulletOptions\r\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  mutate() {\r\n    const { x, y } = this.$coord\r\n    const { width, height } = this.$context.canvas\r\n    if (y < 0 || y > height || x < 0 || x > width) {\r\n      this.destroy()\r\n    }\r\n  }\r\n} as BulletOptions\r\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  mutate() {\r\n    const player = this.$parent.$refs.player\r\n    if (!player) return\r\n    if (this.$coord.dist2(player) < player.judgeRadius ** 2 + this.judgeRadius ** 2) {\r\n      this.hitPlayer()\r\n    }\r\n  }\r\n} as BulletOptions\r\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  mutate() {\r\n    const player = this.$parent.$refs.player\r\n    if (!player) return\r\n    const judgeDist = player.judgeRadius + this.judgeRadius\r\n    const location = this.$coord.locate(player.x, player.y)\r\n    if (Math.abs(location.x) < judgeDist || Math.abs(location.y) < judgeDist) {\r\n      this.hitPlayer()\r\n    }\r\n  }\r\n} as BulletOptions\r\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  mutate() {\r\n    const player = this.$parent.$refs.player\r\n    if (!player) return\r\n    const judgeDist = player.judgeRadius + this.judgeRadius\r\n    if (this.$coord.dist2(player) < judgeDist ** 2) {\r\n      this.hitPlayer()\r\n    }\r\n  }\r\n} as BulletOptions\r\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  state: {\r\n    radius: 6,\r\n    judgeRadius: 4,\r\n    innerR: 4,\r\n    color: 'white',\r\n    bdColor: 'blue',\r\n  },\r\n  display() {\r\n    this.fillCircle(this.getGradient(this.color, this.innerR, this.bdColor))\r\n  },\r\n} as BulletOptions\r\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  state: {\r\n    radius: 20,\r\n    judgeRadius: 14,\r\n    innerR: 8.5,\r\n    color: 'white',\r\n    bdColor: 'blue',\r\n  },\r\n  display() {\r\n    this.fillCircle(this.getGradient(this.color, this.innerR, this.bdColor))\r\n  },\r\n} as BulletOptions\r\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  state: {\r\n    radius: 14,\r\n    judgeRadius: 8.5,\r\n    innerRadius: 9,\r\n    color: 'blue',\r\n    innerColor: 'white',\r\n  },\r\n  display() {\r\n    this.fillCircle(this.getGradient(this.innerColor, this.innerRadius))\r\n  },\r\n} as BulletOptions\r\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  state: {\r\n    radius: 6,\r\n    judgeRadius: 4,\r\n    innerRadius: 4,\r\n    color: 'blue',\r\n    innerColor: 'white',\r\n  },\r\n  display() {\r\n    this.fillCircle(this.getGradient(this.innerColor, this.innerRadius))\r\n  },\r\n} as BulletOptions\r\n","import { BulletOptions } from '@stg/core'\r\n\r\nexport default {\r\n  state: {\r\n    radiusX: 14,\r\n    radiusY: 7,\r\n    judgeRadius: 7,\r\n    color: 'blue',\r\n    innerColor: 'white',\r\n  },\r\n  display() {\r\n    this.fillEllipse()\r\n  },\r\n} as BulletOptions\r\n"],"sourceRoot":""}